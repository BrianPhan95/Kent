/**
 * @license Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
(function(){function u(n){this.editor=n;this.registered={};this.instances={};this.selected=[];this.focused=null;this.widgetHoldingFocusedEditable=null;this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}};fi(this);ui(this);ti(this);ii(this);ni(this);ri(this)}function t(n,i,r,u,f){var e=n.editor;CKEDITOR.tools.extend(this,u,{editor:e,id:i,inline:r.getParent().getName()=="span",element:r,data:CKEDITOR.tools.extend({},typeof u.defaults=="function"?u.defaults():u.defaults),dataReady:!1,inited:!1,ready:!1,edit:t.prototype.edit,focusedEditable:null,definition:u,repository:n,draggable:u.draggable!==!1,_:{downcastFn:u.downcast&&typeof u.downcast=="string"?u.downcasts[u.downcast]:u.downcast}},!0);n.fire("instanceCreated",this);pi(this,u);this.init&&this.init();this.inited=!0;wi(this,f);this.isInited()&&e.editable().contains(this.wrapper)&&(this.ready=!0,this.fire("ready"))}function e(n,t,i){CKEDITOR.dom.element.call(this,t.$);this.editor=n;var r=this.filter=i.filter;CKEDITOR.dtd[this.getName()].p?(this.enterMode=r?r.getAllowedEnterMode(n.enterMode):n.enterMode,this.shiftEnterMode=r?r.getAllowedEnterMode(n.shiftEnterMode,!0):n.shiftEnterMode):this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}function ft(n){var r=n.widgets.registered,t,u,i;for(u in r)t=r[u],i=t.button,i&&n.ui.addButton&&n.ui.addButton(CKEDITOR.tools.capitalize(t.name,!0),{label:i,command:t.name,toolbar:"insert,10"})}function et(n,t){n.addCommand(t.name,{exec:function(){function u(){n.widgets.finalizeCreation(o)}var r=n.widgets.focused,s;if(r&&r.name==t.name)r.edit();else if(t.insert)t.insert();else if(t.template){var h=typeof t.defaults=="function"?t.defaults():t.defaults,f=CKEDITOR.dom.element.createFromHtml(t.template.output(h)),i,e=n.widgets.wrapElement(f,t.name),o=new CKEDITOR.dom.documentFragment(e.getDocument());if(o.append(e),i=n.widgets.initOn(f,t),!i){u();return}s=i.once("edit",function(t){if(t.data.dialog)i.once("dialog",function(t){var r=t.data,f,e;f=r.once("ok",u,null,null,20);e=r.once("cancel",function(){n.widgets.destroy(i,!0)});r.once("hide",function(){f.removeListener();e.removeListener()})});else u()},null,null,999);i.edit();s.removeListener()}},refresh:function(n,t){this.setState(i(n.editable(),t.blockLimit)?CKEDITOR.TRISTATE_DISABLED:CKEDITOR.TRISTATE_OFF)},context:"div",allowedContent:t.allowedContent,requiredContent:t.requiredContent,contentForms:t.contentForms,contentTransformations:t.contentTransformations})}function ot(n,t){var i=t.upcast,r;if(i)if(typeof i=="string")for(r=i.split(",");r.length;)n._.upcasts.push([t.upcasts[r.pop()],t.name]);else n._.upcasts.push([i,t.name])}function s(n,t){if(n.focused=null,t.isInited()){var i=t.editor.checkDirty();n.fire("widgetBlurred",{widget:t});t.setFocused(!1);i||t.editor.resetDirty()}}function st(n){var u=n.data,e,o,i,t,h,r,s;if(this.editor.mode=="wysiwyg"&&(e=this.editor.editable(),o=this.instances,e)){for(t in o)e.contains(o[t].wrapper)||this.destroy(o[t],!0);if(u&&u.initOnlyNew)i=this.initOnAll();else for(s=e.find(".cke_widget_wrapper"),i=[],t=0,h=s.count();t<h;t++)r=s.getItem(t),this.getByElement(r,!0)||at(r,yt)||(r.addClass("cke_widget_new"),i.push(this.initOn(r.getFirst(f))));u&&u.focusInited&&i.length==1&&i[0].focus()}}function ht(n){var t=n.parent;t.type==CKEDITOR.NODE_ELEMENT&&t.attributes["data-cke-widget-wrapper"]&&t.replaceWith(n)}function ct(n,t){for(var e=t.find(".cke_widget_wrapper"),r,i,u=0,o=e.count();u<o;++u)r=e.getItem(u),i=r.getFirst(f),i.type==CKEDITOR.NODE_ELEMENT&&i.data("widget")?(i.replace(r),n.wrapElement(i)):r.remove()}function h(n,t,i){var r,u;return i.allowedContent?(r=this._.filters[n],r||(this._.filters[n]=r={}),u=r[t],u||(r[t]=u=new CKEDITOR.filter(i.allowedContent)),u):null}function lt(n){var t=[],i=n._.upcasts,r=n._.upcastCallbacks;return{toBeWrapped:t,iterator:function(n){var f,e,o,u,s,h;if("data-cke-widget-wrapper"in n.attributes)return n=n.getFirst(a),n&&t.push([n]),!1;if("data-widget"in n.attributes)return t.push([n]),!1;if(s=i.length){if(n.attributes["data-cke-widget-upcasted"])return!1;for(u=0,h=r.length;u<h;++u)if(r[u](n)===!1)return;for(u=0;u<s;++u)if(f=i[u],o={},e=f[0](n,o))return e instanceof CKEDITOR.htmlParser.element&&(n=e),n.attributes["data-cke-widget-data"]=encodeURIComponent(JSON.stringify(o)),n.attributes["data-cke-widget-upcasted"]=1,t.push([n,f[1]]),!1}}}}function at(n,t){for(var i=n;i=i.getParent();)if(t(i))return!0;return!1}function i(n,t){return!t||t.equals(n)?null:y(t)?t:i(n,t.getParent())}function c(n){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off","class":"cke_widget_wrapper cke_widget_new cke_widget_"+(n?"inline":"block")}}function l(n,t,i){var u,r,f;if(n.type==CKEDITOR.NODE_ELEMENT&&(u=CKEDITOR.dtd[n.name],u&&!u[i.name]))return r=n.split(t),f=n.parent,t=r.getIndex(),n.children.length||(t-=1,n.remove()),r.children.length||r.remove(),l(f,t,i);n.add(i,t)}function a(n){return n.type==CKEDITOR.NODE_ELEMENT&&!!n.attributes["data-widget"]}function f(n){return n.type==CKEDITOR.NODE_ELEMENT&&n.hasAttribute("data-widget")}function v(n,t){return typeof n.inline=="boolean"?n.inline:!!CKEDITOR.dtd.$inline[t]}function vt(n){return n.type==CKEDITOR.NODE_ELEMENT&&n.attributes["data-cke-widget-wrapper"]}function o(n){return n.type==CKEDITOR.NODE_ELEMENT&&n.hasAttribute("data-cke-widget-wrapper")}function y(n){return n.type==CKEDITOR.NODE_ELEMENT&&n.hasAttribute("data-cke-widget-editable")}function yt(n){return n.hasAttribute("data-cke-temp")}function pt(n){return n.type==CKEDITOR.NODE_ELEMENT&&n.hasAttribute("data-cke-widget-drag-handler")}function wt(n){return n.type==CKEDITOR.NODE_ELEMENT&&n.hasClass("cke_widget_drag_handler_container")}function p(n,t,i){t.focus();n.fire("saveSnapshot");n.fire("lockSnapshot",{dontUpdate:!0});i.select();var r=t.wrapper.getOuterHtml();t.wrapper.remove();n.widgets.destroy(t,!0);n.execCommand("paste",r);n.fire("unlockSnapshot")}function bt(n,t){var i=t.data.$,r,u=n.createRange(),f,e;if(t.data.testRange)return t.data.testRange;if(document.caretRangeFromPoint)r=n.document.$.caretRangeFromPoint(i.clientX,i.clientY),u.setStart(CKEDITOR.dom.node(r.startContainer),r.startOffset),u.collapse(!0);else if(i.rangeParent)u.setStart(CKEDITOR.dom.node(i.rangeParent),i.rangeOffset),u.collapse(!0);else if(document.body.createTextRange)r=n.document.getBody().$.createTextRange(),r.moveToPoint(i.clientX,i.clientY),f="cke-temp-"+(new Date).getTime(),r.pasteHTML('<span id="'+f+'">​<\/span>'),e=n.document.getById(f),u.moveToPosition(e,CKEDITOR.POSITION_BEFORE_START),e.remove();else return null;return u}function kt(n,t){var r=n.focusedEditable,i,u,f;return t==CKEDITOR.CTRL+65?(u=r.getBogus(),i=n.editor.createRange(),i.selectNodeContents(r),u&&i.setEndAt(u,CKEDITOR.POSITION_BEFORE_START),i.select(),!1):t==8||t==46?(f=n.editor.getSelection().getRanges(),i=f[0],!(f.length==1&&i.collapsed&&i.checkBoundaryOfElement(r,CKEDITOR[t==8?"START":"END"]))):void 0}function r(n,t,i,r){var u=n.editor,e,f;u.fire("lockSnapshot");i?(e=i.data("cke-widget-editable"),f=t.editables[e],n.widgetHoldingFocusedEditable=t,t.focusedEditable=f,i.addClass("cke_widget_editable_focused"),f.filter&&u.setActiveFilter(f.filter),u.setActiveEnterMode(f.enterMode,f.shiftEnterMode)):(r||t.focusedEditable.removeClass("cke_widget_editable_focused"),t.focusedEditable=null,n.widgetHoldingFocusedEditable=null,u.setActiveFilter(null),u.setActiveEnterMode(null,null));u.fire("unlockSnapshot")}function dt(n){n.contextMenu&&n.contextMenu.addListener(function(t){var i=n.widgets.getByElement(t,!0);if(i)return i.fire("contextMenu",{})})}function gt(n,t){return CKEDITOR.tools.trim(t)}function ni(n){var t=n.editor,i=CKEDITOR.plugins.lineutils;t.on("contentDom",function(){var r=t.editable(),u=CKEDITOR.env.ie&&CKEDITOR.env.version<9||r.isInline()?r:t.document;r.attachListener(u,"drop",function(i){var e=i.data.$.dataTransfer.getData("text"),r,f,u;if(e){try{r=JSON.parse(e)}catch(o){return}r.type=="cke-widget"&&(i.data.preventDefault(),r.editor==t.name&&(f=n.instances[r.id]))&&(u=bt(t,i),u)&&(CKEDITOR.env.gecko?setTimeout(p,0,t,f,u):p(t,f,u))}});CKEDITOR.tools.extend(n,{finder:new i.finder(t,{lookups:{"default":function(n){if(!n.is(CKEDITOR.dtd.$listItem)&&n.is(CKEDITOR.dtd.$block)){while(n){if(y(n))return;n=n.getParent()}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}}),locator:new i.locator(t),liner:new i.liner(t,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},!0)})}function ti(n){var t=n.editor;t.on("contentDom",function(){var u=t.editable(),e=u.isInline()?u:t.document,r,f;u.attachListener(e,"mousedown",function(t){var u=t.data.getTarget();if(!u.type)return!1;if(r=n.getByElement(u),f=0,r){if(r.inline&&u.type==CKEDITOR.NODE_ELEMENT&&u.hasAttribute("data-cke-widget-drag-handler")){f=1;return}i(r.wrapper,u)?r=null:(t.data.preventDefault(),CKEDITOR.env.ie||r.focus())}});u.attachListener(e,"mouseup",function(){r&&f&&(f=0,r.focus())});CKEDITOR.env.ie&&u.attachListener(e,"mouseup",function(){r&&setTimeout(function(){r.focus();r=null})})});t.on("doubleclick",function(t){var r=n.getByElement(t.data.element);if(r&&!i(r.wrapper,t.data.element))return r.fire("doubleclick",{element:t.data.element})},null,null,1)}function ii(n){var t=n.editor;t.on("key",function(t){var r=n.focused,u=n.widgetHoldingFocusedEditable,i;return r?i=r.fire("key",{keyCode:t.data.keyCode}):u&&(i=kt(u,t.data.keyCode)),i},null,null,1)}function ri(n){function i(t){n.focused&&nt(n.focused,t.name=="cut")}var t=n.editor;t.on("contentDom",function(){var n=t.editable();n.attachListener(n,"copy",i);n.attachListener(n,"cut",i)})}function ui(n){var t=n.editor;t.on("selectionCheck",function(){n.fire("checkSelection")});n.on("checkSelection",n.checkSelection,n);t.on("selectionChange",function(u){var f=i(t.editable(),u.data.selection.getStartElement()),e=f&&n.getByElement(f),o=n.widgetHoldingFocusedEditable;o?o===e&&o.focusedEditable.equals(f)||(r(n,o,null),e&&f&&r(n,e,f)):e&&f&&r(n,e,f)});t.on("dataReady",function(){b(n).commit()});t.on("blur",function(){var t;(t=n.focused)&&s(n,t);(t=n.widgetHoldingFocusedEditable)&&r(n,t,null)})}function fi(n){oi(n);ei(n);n.on("checkWidgets",st);n.editor.on("contentDomInvalidated",n.checkWidgets,n)}function ei(n){var t=n.editor,i={};t.on("toDataFormat",function(t){var u=CKEDITOR.tools.getNextNumber(),r=[];t.data.downcastingSessionId=u;i[u]=r;t.data.dataValue.forEach(function(t){var i=t.attributes,f,u;if("data-cke-widget-id"in i)f=n.instances[i["data-cke-widget-id"]],f&&(u=t.getFirst(a),r.push({wrapper:t,element:u,widget:f,editables:{}}),u.attributes["data-cke-widget-keep-attr"]!="1"&&delete u.attributes["data-widget"]);else if("data-cke-widget-editable"in i)return r[r.length-1].editables[i["data-cke-widget-editable"]]=t,!1},CKEDITOR.NODE_ELEMENT,!0)},null,null,8);t.on("toDataFormat",function(n){if(n.data.downcastingSessionId)for(var s=i[n.data.downcastingSessionId],t,r,f,u,e,o;t=s.shift();){r=t.widget;f=t.element;u=r._.downcastFn&&r._.downcastFn.call(r,f);for(o in t.editables)e=t.editables[o],delete e.attributes.contenteditable,e.setHtml(r.editables[o].getData());u||(u=f);t.wrapper.replaceWith(u)}},null,null,13);t.on("contentDomUnload",function(){n.destroyAll(!0)})}function oi(n){function u(){t.fire("lockSnapshot");n.checkWidgets({initOnlyNew:!0,focusInited:r});t.fire("unlockSnapshot")}var t=n.editor,r,i;t.on("toHtml",function(t){var u=lt(n),i;for(t.data.dataValue.forEach(u.iterator,CKEDITOR.NODE_ELEMENT,!0);i=u.toBeWrapped.pop();)ht(i[0]),n.wrapElement(i[0],i[1]);r=t.data.dataValue.children.length==1&&vt(t.data.dataValue.children[0])},null,null,8);t.on("dataReady",function(){i&&ct(n,t.editable());i=0;n.destroyAll(!0);n.initOnAll()});t.on("loadSnapshot",function(t){/data-cke-widget/.test(t.data)&&(i=1);n.destroyAll(!0)},null,null,9);t.on("paste",function(n){n.data.dataValue=n.data.dataValue.replace(w,gt)});t.on("insertText",u,null,null,999);t.on("insertHtml",u,null,null,999)}function b(n){var i=n.selected,u=[],r=i.slice(0),t=null;return{select:function(n){CKEDITOR.tools.indexOf(i,n)<0&&u.push(n);var t=CKEDITOR.tools.indexOf(r,n);return t>=0&&r.splice(t,1),this},focus:function(n){return t=n,this},commit:function(){var o=n.focused!==t,f,e;for(n.editor.fire("lockSnapshot"),o&&(f=n.focused)&&s(n,f);f=r.pop();)i.splice(CKEDITOR.tools.indexOf(i,f),1),f.isInited()&&(e=f.editor.checkDirty(),f.setSelected(!1),e||f.editor.resetDirty());for(o&&t&&(e=n.editor.checkDirty(),n.focused=t,n.fire("widgetFocused",{widget:t}),t.setFocused(!0),e||n.editor.resetDirty());f=u.pop();)i.push(f),f.setSelected(!0);n.editor.fire("unlockSnapshot")}}}function d(n,t,i){var f=0,e=tt(t),r=n.data.classes||{},u;if(e){for(r=CKEDITOR.tools.clone(r);u=e.pop();)i?r[u]||(f=r[u]=1):r[u]&&(delete r[u],f=1);f&&n.setData("classes",r)}}function g(n){n.cancel()}function nt(n,t){var i=n.editor,u=i.document,c,l,e,a,o;if(!u.getById("cke_copybin")){var s=i.blockless||CKEDITOR.env.ie?"span":"div",r=u.createElement(s),f=u.createElement(s),h=CKEDITOR.env.ie&&CKEDITOR.env.version<9;f.setAttributes({id:"cke_copybin","data-cke-temp":"1"});r.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"});r.setStyle(i.config.contentsLangDirection=="ltr"?"left":"right","-5000px");r.setHtml('<span data-cke-copybin-start="1">​<\/span>'+n.wrapper.getOuterHtml()+'<span data-cke-copybin-end="1">​<\/span>');i.fire("saveSnapshot");i.fire("lockSnapshot");f.append(r);i.editable().append(f);c=i.on("selectionChange",g,null,null,0);l=n.repository.on("checkSelection",g,null,null,0);h&&(e=u.getDocumentElement().$,a=e.scrollTop);o=i.createRange();o.selectNodeContents(r);o.select();h&&(e.scrollTop=a);setTimeout(function(){t||n.focus();f.remove();c.removeListener();l.removeListener();i.fire("unlockSnapshot");t&&(n.repository.del(n),i.fire("saveSnapshot"))},100)}}function tt(n){var t=n.getDefinition().attributes,i=t&&t["class"];return i?i.split(/\s+/):null}function it(){var i=CKEDITOR.document.getActive(),n=this.editor,t=n.editable();(t.isInline()?t:n.document.getWindow().getFrame()).equals(i)&&n.focusManager.focus(t)}function rt(){CKEDITOR.env.gecko&&this.editor.unlockSelection();CKEDITOR.env.webkit||(this.editor.forceNextSelectionCheck(),this.editor.selectionChange(1))}function si(n){var t=null;n.on("data",function(){var n=this.data.classes,i;if(t!=n){for(i in t)n&&n[i]||this.removeClass(i);for(i in n)this.addClass(i);t=n}})}function hi(t){if(t.draggable){var u=t.editor,i=t.wrapper.getLast(wt),r;i?r=i.findOne("img"):(i=new CKEDITOR.dom.element("span",u.document),i.setAttributes({"class":"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+u.plugins.widget.path+"images/handle.png)"}),r=new CKEDITOR.dom.element("img",u.document),r.setAttributes({"class":"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:CKEDITOR.tools.transparentImageData,width:n,title:u.lang.widget.move,height:n}),t.inline&&r.setAttribute("draggable","true"),i.append(r),t.wrapper.append(i));t.wrapper.on("mouseenter",t.updateDragHandlerPosition,t);if(setTimeout(function(){t.on("data",t.updateDragHandlerPosition,t)},50),t.inline)r.on("dragstart",function(n){n.data.$.dataTransfer.setData("text",JSON.stringify({type:"cke-widget",editor:u.name,id:t.id}))});else r.on("mousedown",ci,t);t.dragHandlerContainer=i}}function ci(){function c(){var i;for(o.reset();i=n.pop();)i.removeListener();li.call(this,t)}var l=this.repository.finder,r=this.repository.locator,i=this.repository.liner,u=this.editor,f=u.editable(),n=[],t=[],e=l.greedySearch(),o=CKEDITOR.tools.eventsBuffer(50,function(){s=r.locate(e);t=r.sort(h,1);t.length&&(i.prepare(e,s),i.placeLine(t[0]),i.cleanup())}),s,h;f.addClass("cke_widget_dragging");n.push(f.on("mousemove",function(n){h=n.data.$.clientY;o.input()}));n.push(u.document.once("mouseup",c,this));n.push(CKEDITOR.document.once("mouseup",c,this))}function li(n){var f=this.repository.finder,i=this.repository.liner,t=this.editor,r=this.editor.editable(),u;CKEDITOR.tools.isEmpty(i.visible)||(u=f.getRange(n[0]),this.focus(),t.fire("saveSnapshot"),t.fire("lockSnapshot",{dontUpdate:1}),t.getSelection().reset(),r.insertElementIntoRange(this.wrapper,u),this.focus(),t.fire("unlockSnapshot"),t.fire("saveSnapshot"));r.removeClass("cke_widget_dragging");i.hideVisible()}function ai(n){var i,t,r=n.editables;if(n.editables={},n.editables)for(i in r)t=r[i],n.initEditable(i,typeof t=="string"?{selector:t}:t)}function vi(n){if(n.mask){var t=n.wrapper.findOne(".cke_widget_mask");t||(t=new CKEDITOR.dom.element("img",n.editor.document),t.setAttributes({src:CKEDITOR.tools.transparentImageData,"class":"cke_reset cke_widget_mask"}),n.wrapper.append(t));n.mask=t}}function yi(n){if(n.parts){var t={},i;for(var r in n.parts)i=n.wrapper.findOne(n.parts[r]),t[r]=i;n.parts=t}}function pi(n,t){if(bi(n),yi(n),ai(n),vi(n),hi(n),si(n),CKEDITOR.env.ie&&CKEDITOR.env.version<9)n.wrapper.on("dragstart",function(t){var r=t.data.getTarget();i(n,r)||n.inline&&pt(r)||t.data.preventDefault()});n.wrapper.removeClass("cke_widget_new");n.element.addClass("cke_widget_element");n.on("key",function(t){var i=t.data.keyCode;if(i==13)n.edit();else{if(i==CKEDITOR.CTRL+67||i==CKEDITOR.CTRL+88){nt(n,i==CKEDITOR.CTRL+88);return}if(i in k||CKEDITOR.CTRL&i||CKEDITOR.ALT&i)return}return!1},null,null,999);n.on("doubleclick",function(t){n.edit()&&t.cancel()});if(t.data)n.on("data",t.data);if(t.edit)n.on("edit",t.edit)}function wi(n,t){var i=n.element.data("cke-widget-data");i&&n.setData(JSON.parse(decodeURIComponent(i)));t&&n.setData(t);n.data.classes||n.setData("classes",n.getClasses());n.dataReady=!0;ut(n);n.fire("data",n.data)}function bi(n){var t=n.wrapper=n.element.getParent();t.setAttribute("data-cke-widget-id",n.id)}function ut(n){n.element.data("cke-widget-data",encodeURIComponent(JSON.stringify(n.data)))}var n=15,w,k;CKEDITOR.plugins.add("widget",{lang:"af,ar,ca,cs,cy,da,de,el,en,en-gb,eo,es,fa,fi,fr,gl,he,hr,hu,it,ja,km,ko,ku,nb,nl,no,pl,pt,pt-br,ru,sk,sl,sq,sv,tr,tt,uk,vi,zh,zh-cn",requires:"lineutils,clipboard",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid yellow;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid yellow}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #ace}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:"+n+"px;height:0;left:-9999px;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:"+n+"px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:"+n+"px;height:"+n+"px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}")},beforeInit:function(n){n.widgets=new u(n)},afterInit:function(n){ft(n);dt(n)}});u.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(n,t){return t=CKEDITOR.tools.prototypedCopy(t),t.name=n,t._=t._||{},this.editor.fire("widgetDefinition",t),t.template&&(t.template=new CKEDITOR.template(t.template)),et(this.editor,t),ot(this,t),this.registered[n]=t,t},addUpcastCallback:function(n){this._.upcastCallbacks.push(n)},checkSelection:function(){var u=this.editor.getSelection(),f=u.getSelectedElement(),n=b(this),i,t,r,e;if(f&&(i=this.getByElement(f,!0)))return n.focus(i).select(i).commit();if(t=u.getRanges()[0],!t||t.collapsed)return n.commit();for(r=new CKEDITOR.dom.walker(t),r.evaluator=o;e=r.next();)n.select(this.getByElement(e));n.commit()},checkWidgets:function(n){this.fire("checkWidgets",CKEDITOR.tools.copy(n||{}))},del:function(n){if(this.focused===n){var r=n.editor,t=r.createRange(),i;(i=t.moveToClosestEditablePosition(n.wrapper,!0))||(i=t.moveToClosestEditablePosition(n.wrapper,!1));i&&r.getSelection().selectRanges([t])}n.wrapper.remove();this.destroy(n,!0)},destroy:function(n,t){this.widgetHoldingFocusedEditable===n&&r(this,n,null,t);n.destroy(t);delete this.instances[n.id];this.fire("instanceDestroyed",n)},destroyAll:function(n){var t=this.instances,i;for(var r in t)i=t[r],this.destroy(i,n)},finalizeCreation:function(n){var t=n.getFirst(),i;t&&o(t)&&(this.editor.insertElement(t),i=this.getByElement(t),i.ready=!0,i.fire("ready"),i.focus())},getByElement:function(){function n(n){return n.is(t)&&n.data("cke-widget-id")}var t={div:1,span:1};return function(t,i){var r,u;if(!t)return null;if(r=n(t),!i&&!r){u=this.editor.editable();do t=t.getParent();while(t&&!t.equals(u)&&!(r=n(t)))}return this.instances[r]||null}}(),initOn:function(n,i,r){var f,u;return(i?typeof i=="string"&&(i=this.registered[i]):i=this.registered[n.data("widget")],!i)?null:(f=this.wrapElement(n,i.name),f)?f.hasClass("cke_widget_new")?(u=new t(this,this._.nextId++,n,i,r),u.isInited()?(this.instances[u.id]=u,u):null):this.getByElement(n):null},initOnAll:function(n){for(var i=(n||this.editor.editable()).find(".cke_widget_new"),r=[],t,u=i.count();u--;)t=this.initOn(i.getItem(u).getFirst(f)),t&&r.push(t);return r},parseElementClasses:function(n){if(!n)return null;n=CKEDITOR.tools.trim(n).split(/\s+/);for(var t,i={},r=0;t=n.pop();)t.indexOf("cke_")==-1&&(i[t]=r=1);return r?i:null},wrapElement:function(n,t){var i=null,r,u,f,e;if(n instanceof CKEDITOR.dom.element){if(r=this.registered[t||n.data("widget")],!r)return null;if(i=n.getParent(),i&&i.type==CKEDITOR.NODE_ELEMENT&&i.data("cke-widget-wrapper"))return i;n.hasAttribute("data-cke-widget-keep-attr")||n.data("cke-widget-keep-attr",n.data("widget")?1:0);t&&n.data("widget",t);u=v(r,n.getName());i=new CKEDITOR.dom.element(u?"span":"div");i.setAttributes(c(u));i.data("cke-display-name",r.pathName?r.pathName:n.getName());n.getParent(!0)&&i.replace(n);n.appendTo(i)}else if(n instanceof CKEDITOR.htmlParser.element){if(r=this.registered[t||n.attributes["data-widget"]],!r)return null;if(i=n.parent,i&&i.type==CKEDITOR.NODE_ELEMENT&&i.attributes["data-cke-widget-wrapper"])return i;"data-cke-widget-keep-attr"in n.attributes||(n.attributes["data-cke-widget-keep-attr"]=n.attributes["data-widget"]?1:0);t&&(n.attributes["data-widget"]=t);u=v(r,n.name);i=new CKEDITOR.htmlParser.element(u?"span":"div",c(u));i.attributes["data-cke-display-name"]=r.pathName?r.pathName:n.name;f=n.parent;f&&(e=n.getIndex(),n.remove());i.add(n);f&&l(f,e,i)}return i},_tests_getNestedEditable:i,_tests_createEditableFilter:h};CKEDITOR.event.implementOn(u.prototype);t.prototype={addClass:function(n){this.element.addClass(n)},applyStyle:function(n){d(this,n,1)},checkStyleActive:function(n){var t=tt(n),i;if(!t)return!1;while(i=t.pop())if(!this.hasClass(i))return!1;return!0},destroy:function(n){if(this.fire("destroy"),this.editables)for(var t in this.editables)this.destroyEditable(t,n);n||(this.element.data("cke-widget-keep-attr")=="0"&&this.element.removeAttribute("data-widget"),this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]),this.element.removeClass("cke_widget_element"),this.element.replace(this.wrapper));this.wrapper=null},destroyEditable:function(n,t){var i=this.editables[n];i.removeListener("focus",rt);i.removeListener("blur",it);this.editor.focusManager.remove(i);t||(i.removeClass("cke_widget_editable"),i.removeClass("cke_widget_editable_focused"),i.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"]));delete this.editables[n]},edit:function(){var t={dialog:this.dialog},n=this;return this.fire("edit",t)===!1||!t.dialog?!1:(this.editor.openDialog(t.dialog,function(t){var i,r;if(n.fire("dialog",t)!==!1){i=t.on("show",function(){t.setupContent(n)});r=t.on("ok",function(){var i,r=n.on("data",function(n){i=1;n.cancel()},null,null,0);n.editor.fire("saveSnapshot");t.commitContent(n);r.removeListener();i&&(n.fire("data",n.data),n.editor.fire("saveSnapshot"))});t.once("hide",function(){i.removeListener();r.removeListener()})}}),!0)},getClasses:function(){return this.repository.parseElementClasses(this.element.getAttribute("class"))},hasClass:function(n){return this.element.hasClass(n)},initEditable:function(n,t){var i=this.wrapper.findOne(t.selector);if(i&&i.is(CKEDITOR.dtd.$editable)){i=new e(this.editor,i,{filter:h.call(this.repository,this.name,n,t)});this.editables[n]=i;i.setAttributes({contenteditable:"true","data-cke-widget-editable":n,"data-cke-enter-mode":i.enterMode});i.filter&&i.data("cke-filter",i.filter.id);i.addClass("cke_widget_editable");i.removeClass("cke_widget_editable_focused");t.pathName&&i.data("cke-display-name",t.pathName);this.editor.focusManager.add(i);i.on("focus",rt,this);return CKEDITOR.env.ie&&i.on("blur",it,this),i.setData(i.getHtml()),!0}return!1},isInited:function(){return!!(this.wrapper&&this.inited)},isReady:function(){return this.isInited()&&this.ready},focus:function(){var n=this.editor.getSelection(),t;n&&(t=this.editor.checkDirty(),n.fake(this.wrapper),t||this.editor.resetDirty());this.editor.focus()},removeClass:function(n){this.element.removeClass(n)},removeStyle:function(n){d(this,n,0)},setData:function(n,t){var i=this.data,u=0,r;if(typeof n=="string")i[n]!==t&&(i[n]=t,u=1);else{r=n;for(n in r)i[n]!==r[n]&&(u=1,i[n]=r[n])}return u&&this.dataReady&&(ut(this),this.fire("data",i)),this},setFocused:function(n){return this.wrapper[n?"addClass":"removeClass"]("cke_widget_focused"),this.fire(n?"focus":"blur"),this},setSelected:function(n){return this.wrapper[n?"addClass":"removeClass"]("cke_widget_selected"),this.fire(n?"select":"deselect"),this},updateDragHandlerPosition:function(){var i=this.editor,u=this.element.$,r=this._.dragHandlerOffset,t={x:u.offsetLeft,y:u.offsetTop-n},f;r&&t.x==r.x&&t.y==r.y||(f=i.checkDirty(),i.fire("lockSnapshot"),this.dragHandlerContainer.setStyles({top:t.y+"px",left:t.x+"px"}),i.fire("unlockSnapshot"),f||i.resetDirty(),this._.dragHandlerOffset=t)}};CKEDITOR.event.implementOn(t.prototype);e.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(n){n=this.editor.dataProcessor.toHtml(n,{context:this.getName(),filter:this.filter,enterMode:this.enterMode});this.setHtml(n);this.editor.widgets.initOnAll(this)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});w=new RegExp('^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?<\/span>([\\s\\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?<\/span>(?:<\/(?:div|span)>)?(?:<\/(?:div|span)>)?$');k={37:1,38:1,39:1,40:1,8:1,46:1},function(){function n(){}function t(n,t,i){if(!i||!this.checkElement(n))return!1;var r=i.widgets.getByElement(n,!0);return r&&r.checkStyleActive(this)}CKEDITOR.style.addCustomHandler({type:"widget",setup:function(n){this.widget=n.widget},apply:function(n){n instanceof CKEDITOR.editor&&this.checkApplicable(n.elementPath(),n)&&n.widgets.focused.applyStyle(this)},remove:function(n){n instanceof CKEDITOR.editor&&this.checkApplicable(n.elementPath(),n)&&n.widgets.focused.removeStyle(this)},checkActive:function(n,t){return this.checkElementMatch(n.lastElement,0,t)},checkApplicable:function(n,t){return(t instanceof CKEDITOR.editor)?this.checkElement(n.lastElement):!1},checkElementMatch:t,checkElementRemovable:t,checkElement:function(n){if(!o(n))return!1;var t=n.getFirst(f);return t&&t.data("widget")==this.widget},buildPreview:function(n){return n||this._.definition.name},toAllowedContentRules:function(n){if(!n)return null;var t=n.widgets.registered[this.widget],i,r={};return t?t.styleableElements?(i=this.getClassesArray(),!i)?null:(r[t.styleableElements]={classes:i,propertiesOnly:!0},r):t.styleToAllowedContentRules?t.styleToAllowedContentRules(this):null:null},getClassesArray:function(){var n=this._.definition.attributes&&this._.definition.attributes["class"];return n?CKEDITOR.tools.trim(n).split(/\s+/):null},applyToRange:n,removeFromRange:n,applyToObject:n})}();CKEDITOR.plugins.widget=t;t.repository=u;t.nestedEditable=e})();
//# sourceMappingURL=plugin.min.js.map
