/*!
    photobox v1.9.9
    (c) 2013 Yair Even Or <http://dropthebit.com>
    MIT-style license.
*/
(function(n,t,i){"use strict";function ai(n,t){var i=!1;return function(){i||(n.call(),i=!0,setTimeout(function(){i=!1},t))}}function ui(){kt&&u.hide();n(t).on("touchstart.testMouse",function(){n(t).off("touchstart.testMouse");ct=!0;u.addClass("mobile")});v.off().on("click",s.toggle);c.off().on("click","a",d.click);a&&u.addClass("msie");u.off().on("click","img",function(n){n.stopPropagation()});n(t.body).append(u);g=t.documentElement}function vi(n,t,i){t==1?(f.css({transform:"translateX(25%)",transition:".2s",opacity:0}),setTimeout(function(){tt(k)},200)):t==-1&&(f.css({transform:"translateX(-25%)",transition:".2s",opacity:0}),setTimeout(function(){tt(p)},200));i==1?ht.prop("checked",!0):i==-1&&ht.prop("checked",!1)}function fi(n){var i,u=t.createElement("p").style,r=["ms","O","Moz","Webkit"];if(u[n]=="")return n;for(n=n.charAt(0).toUpperCase()+n.slice(1),i=r.length;i--;)if(u[r[i]+n]=="")return r[i]+n}function yi(t){var i=t.keyCode,u=r.keys;return n.inArray(i,u.close)>=0&&ot()||n.inArray(i,u.next)>=0&&!r.single&&ft(p)||n.inArray(i,u.prev)>=0&&!r.single&&ft(k)||!0}function pi(n,t,i){i==1?ft(p):i==-1&&ft(k)}function ei(){var n=this.id=="pbPrevBtn"?k:p;return ft(n),!1}function wi(n){bt=o;o=n;y=e[n][0];k=(o||(r.loop?e.length:0))-1;p=(o+1)%e.length||(r.loop?0:-1)}function ft(n){if(!r.loop){var t=o==e.length-1&&n==p,i=o==0&&n==k;if(t||i)return}tt(n)}function bi(){var t=e[o][0],i=n("<a>").prop("href",e[o][0])[0].search?"&":"?";return t+=i+"vq=hd720&wmode=opaque",n("<iframe>").prop({scrolling:"no",frameborder:0,allowTransparency:!0,src:t}).attr({webkitAllowFullScreen:!0,mozallowfullscreen:!0,allowFullScreen:!0})}function wt(){if(vt.off(w).removeClass("change"),r.counter){try{var n=r.counter.replace("A",o+1).replace("B",e.length)}catch(t){r.counter="(A/B)";wt()}ut.find(".counter").text(n)}r.title&&ut.find(".title").html("<span>"+e[o][1]+"<\/span>")}function ki(){u.addClass("error");f[0].src=lt;b.onerror=null}function oi(n){function i(){clearTimeout(r);t.off(w).css({transition:"none"});u.removeClass("video");rt=="video"?(f[0].src=lt,h.addClass("prepare"),u.addClass("video")):f.prop({src:y,"class":"prepare"});setTimeout(function(){f.add(h).removeAttr("style").removeClass("prepare");u.removeClass("pbHide next prev");setTimeout(function(){f.add(h).on(w,si);a&&si()},0)},50)}var t,r;if(r=setTimeout(i,2e3),yt.fadeOut(300,function(){u.removeClass("pbLoading");yt.removeAttr("style")}),u.addClass("pbHide"),f.add(h).removeAttr("style").removeClass("zoomable"),n||it[bt].rel!="video"?t=f:(t=h,f.addClass("prepare")),n||a)i();else t.on(w,i)}function si(){f.add(h).off(w).addClass("zoomable");rt=="video"?h.removeClass("pbHide"):v&&r.autoplay&&s.play();l&&typeof l.callback=="function"&&l.callback.apply(it[o])}function di(i,r,u){var e,o;if(u)return!1;if(rt=="video"){if(e=h.data("zoom")||1,e+=r/10,e<.5)return!1;h.data("zoom",e).css({width:624*e,height:351*e})}else if(e=f.data("zoom")||1,o=f[0].getBoundingClientRect(),e+=r/10,e<.1&&(e=.1),at(function(){f.data("zoom",e).css({transform:"scale("+e+")"})}),o.height>g.clientHeight||o.width>g.clientWidth)n(t).on("mousemove.photobox",nr);else n(t).off("mousemove.photobox"),f[0].style[dt]="50% 50%";return!1}function gi(n,t){n.preventDefault();n.stopPropagation();var r=l.thumbsList,i;r.css("height",r[0].clientHeight+t*10);i=ut[0].clientHeight/2;pt[0].style.cssText="margin-top: -"+i+"px; padding: "+i+"px 0;";c.hide().show(0)}function nr(n){var t=n.clientY/g.clientHeight*(g.clientHeight+200)-100,i=t/g.clientHeight*100,r=n.clientX/g.clientWidth*100,u=r.toFixed(2)+"% "+i.toFixed(2)+"%";at(function(){f[0].style[dt]=u})}function hi(){clearTimeout(s.autoPlayTimer);n(t).off("mousemove.photobox");b.onload=function(){};b.src=gt.src=ni.src=y}function ot(){function t(){u[0].className!=""&&(u.removeClass("show pbHide error pbLoading"),f.removeAttr("class").removeAttr("style").off().data("zoom",1),f[0].src=lt,ut.find(".title").empty(),kt&&setTimeout(function(){u.hide()},200),r.hideFlash&&n("iframe, object, embed").css("visibility","visible"))}if(!u.hasClass("show"))return!1;hi();h.find("iframe").prop("src","").empty();st.prototype.setup();et.clear();u.removeClass("on video").addClass("pbHide");o=-1;f.on(w,t);a&&t();setTimeout(function(){l=null},1e3);setTimeout(t,500);typeof r.afterClose=="function"&&r.afterClose(u)}var st,l,r,e=[],it,o=-1,y,bt,rt,k,p,d,g,s,tt,a=!("placeholder"in t.createElement("input")),kt=function(){var t=n("<p>")[0];return t.style.cssText="pointer-events:auto",!t.style.pointerEvents}(),ct=!1,nt=n(),lt="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",dt=fi("transformOrigin"),ci=fi("transition"),w="transitionend webkitTransitionEnd oTransitionEnd otransitionend",at=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(n){return window.setTimeout(n,1e3/60)},b={},gt=new Image,ni=new Image,li,f,h,ti,ii,ht,ut,vt,yt,v,c,pt,ri={single:!1,beforeShow:null,afterClose:null,loop:!0,thumb:null,thumbs:!0,thumbAttr:"data-src",counter:"(A/B)",title:!0,autoplay:!1,time:3e3,history:!1,hideFlash:!0,zoomable:!0,wheelNextPrev:!0,keys:{close:[27,88,67],prev:[37,80],next:[39,78]}},u=n('<div id="pbOverlay">').append(ht=n('<input type="checkbox" id="pbThumbsToggler" checked hidden>'),yt=n('<div class="pbLoader"><b><\/b><b><\/b><b><\/b><\/div>'),ti=n('<div id="pbPrevBtn" class="prevNext"><b><\/b><\/div>').on("click",ei),ii=n('<div id="pbNextBtn" class="prevNext"><b><\/b><\/div>').on("click",ei),pt=n('<div class="pbWrapper">').append(f=n("<img>"),h=n("<div>")),li=n('<div id="pbCloseBtn">').on("click",ot)[0],v=n('<div id="pbAutoplayBtn">').append(n('<div class="pbProgress">')),ut=n('<div id="pbCaption">').append('<label for="pbThumbsToggler" title="thumbnails on/off"><\/label>',vt=n('<div class="pbCaptionText">').append('<div class="title"><\/div><div class="counter">'),c=n("<div>").addClass("pbThumbs"))),et;n.fn.photobox=function(t,i,r){return this.each(function(){var u,f=n(this).data("_photobox");if(f)return t==="destroy"&&f.destroy(),this;if(typeof t!="string"&&(t="a"),t==="prepareDOM")return ui(),this;u=n.extend({},ri,i||{});l=new st(u,this,t);n(this).data("_photobox",l);l.callback=r})};st=function(i,r,u){this.options=n.extend({},i);this.target=u;this.selector=n(r||t);this.thumbsList=null;var f=this.imageLinksFilter(this.selector.find(u));this.imageLinks=f[0];this.images=f[1];this.init()};st.prototype={init:function(){var n=this;this.selector.one("mouseenter.photobox",this.target,function(){n.thumbsList=d.generate.apply(n)});this.selector.on("click.photobox",this.target,function(t){t.preventDefault();n.open(this)});this.observerTimeout=null;a||this.selector[0].nodeType!=1||this.observeDOM(this.selector[0],this.onDOMchanges.bind(this))},onDOMchanges:function(){var n=this;clearTimeout(this.observerTimeout);n.observerTimeout=setTimeout(function(){var i=n.imageLinksFilter(n.selector.find(n.target)),t=0,u=!1,r;if(n.imageLinks.length!=i[0].length){if(n.imageLinks=i[0],n.images=i[1],l&&n.selector==l.selector)for(e=n.images,it=n.imageLinks,r=e.length;r--;)e[r][0]==y&&(u=!0);n.thumbsList=d.generate.apply(n);c.html(n.thumbsList);n.images.length&&y&&n.options.thumbs&&(t=n.thumbsList.find('a[href="'+y+'"]').eq(0).parent().index(),t==-1&&(t=0),d.changeActive(t,0))}},50)},open:function(t){var i=n.inArray(t,this.imageLinks);return i==-1?!1:(r=this.options,e=this.images,it=this.imageLinks,l=this,this.setup(1),u.on(w,function(){u.off(w).addClass("on");tt(i,!0)}).addClass("show"),a&&u.trigger("MSTransitionEnd"),!1)},imageLinksFilter:function(t){var u=this,f=[],i={},r;return[t.filter(function(){var e=n(this),t,o="";return i.content=e[0].getAttribute("title")||"",u.options.thumb&&(t=e.find(u.options.thumb)[0]),u.options.thumb&&t||(t=e.find("img")[0]),t&&(r=t.getAttribute("data-pb-captionlink"),o=t.getAttribute(u.options.thumbAttr)||t.getAttribute("src"),i.content=t.getAttribute("alt")||t.getAttribute("title")||""),r&&(r=r.split("["),r.length==2?(i.linkText=r[0],i.linkHref=r[1].slice(0,-1)):(i.linkText=r,i.linkHref=r),i.content+=' <a href="'+i.linkHref+'">'+i.linkText+"<\/a>"),f.push([e[0].href,i.content,o]),!0}),f]},observeDOM:function(){var n=i.MutationObserver||i.WebKitMutationObserver,t=i.addEventListener;return function(i,r){if(n){var u=this,f=new n(function(n){(n[0].addedNodes.length||n[0].removedNodes.length)&&r(u)});f.observe(i,{childList:!0,subtree:!0})}else t&&(i.addEventListener("DOMNodeInserted",r.bind(u),!1),i.addEventListener("DOMNodeRemoved",r.bind(u),!1))}}(),setup:function(e){var o=e?"on":"off";r.thumbs&&(ct||c[o]("mouseenter.photobox",d.calc)[o]("mousemove.photobox",d.move));e?(f.css({transition:"0s"}).removeAttr("style"),u.show(),c.html(this.thumbsList).trigger("mouseenter.photobox"),r.thumbs?u.addClass("thumbs"):(ht.prop("checked",!1),u.removeClass("thumbs")),this.images.length<2||r.single?u.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(u.addClass("hasArrows hasCounter"),r.time>1e3?(u.addClass("hasAutoplay"),r.autoplay?s.progress.start():s.pause()):u.removeClass("hasAutoplay")),r.hideFlash&&n("iframe, object, embed").css("visibility","hidden")):n(i).off("resize.photobox");n(t).off("keydown.photobox")[o]({"keydown.photobox":yi});ct&&(u.removeClass("hasArrows"),pt[o]("swipe",vi));r.zoomable&&(u[o]({"mousewheel.photobox":di}),a||c[o]({"mousewheel.photobox":gi}));!r.single&&r.wheelNextPrev&&u[o]({"mousewheel.photobox":ai(pi,1e3)})},destroy:function(){r=this.options;this.selector.off("click.photobox",this.target).removeData("_photobox");ot()}};d=function(){var t=0,u=0,o=0,s=0,f=null,i,e,h,l;return{generate:function(){for(var u=n("<ul>"),f=[],s=this.imageLinks.size(),e,r,i,o,t=0;t<s;t++)(i=this.imageLinks[t],r=this.images[t][2],r)&&(e=this.images[t][1],o=i.rel?" class='"+i.rel+"'":"",f.push("<li"+o+'><a href="'+i.href+'"><img src="'+r+'" alt="" title="'+e+'" /><\/a><\/li>'));return u.html(f.join("")),u},click:function(t){t.preventDefault();nt.removeClass("active");nt=n(this).parent().addClass("active");var i=n(this.parentNode).index();return tt(i,0,1)},changeActiveTimeout:null,changeActive:function(n,t,i){if(r.thumbs){var u=nt.index();(nt.removeClass("active"),nt=c.find("li").eq(n).addClass("active"),!i&&nt[0])&&(clearTimeout(this.changeActiveTimeout),this.changeActiveTimeout=setTimeout(function(){var n=nt[0].offsetLeft+nt[0].clientWidth/2-g.clientWidth/2;t?c.delay(800):c.stop();c.animate({scrollLeft:n},500,"swing")},200))}},calc:function(n){return e=c[0],t=e.clientWidth,u=e.scrollWidth,i=.15*t,o=c.offset().left,s=n.pageX-i-o,l=s/(t-i*2),h=(u-t)*l,c.animate({scrollLeft:h},200),clearTimeout(f),f=setTimeout(function(){f=null},200),this},move:function(n){if(!f){var c=u/t,r=n.pageX-i-o,s,h;r<0&&(r=0);s=r/(t-i*2);h=(u-t)*s;at(function(){e.scrollLeft=h})}}}}();s={autoPlayTimer:!1,play:function(){s.autoPlayTimer=setTimeout(function(){tt(p)},r.time);s.progress.start();v.removeClass("play");s.setTitle("Click to stop autoplay");r.autoplay=!0},pause:function(){clearTimeout(s.autoPlayTimer);s.progress.reset();v.addClass("play");s.setTitle("Click to resume autoplay");r.autoplay=!1},progress:{reset:function(){v.find("div").removeAttr("style");setTimeout(function(){v.removeClass("playing")},200)},start:function(){a||v.find("div").css(ci,r.time+"ms");v.addClass("playing")}},setTitle:function(n){n&&v.prop("title",n+" (every "+r.time/1e3+" seconds)")},toggle:function(n){n.stopPropagation();s[r.autoplay?"pause":"play"]()}};tt=function(){var n;return function(t,i,c){if(!n){if(n=setTimeout(function(){n=null},150),(!t||t<0)&&(t=0),r.loop||(ii.toggleClass("pbHide",t==e.length-1),ti.toggleClass("pbHide",t==0)),typeof r.beforeShow=="function"&&r.beforeShow(it[t]),u.removeClass("error"),o>=0&&u.addClass(t>o?"next":"prev"),wi(t),hi(),h.empty(),b.onerror=null,f.add(h).data("zoom",1),rt=it[t].rel=="video"?"video":"image",rt=="video")h.html(bi()).addClass("pbHide"),oi(i);else{var l=setTimeout(function(){u.addClass("pbLoading")},50);a&&u.addClass("pbHide");r.autoplay&&s.progress.reset();b=new Image;b.onload=function(){b.onload=null;k>=0&&(gt.src=e[k][0]);p>=0&&(ni.src=e[p][0]);clearTimeout(l);oi(i)};b.onerror=ki;b.src=y}vt.on(w,wt).addClass("change");(i||a)&&wt();d.changeActive(t,i,c);et.save()}}}();et={save:function(){"pushState"in window.history&&decodeURIComponent(window.location.hash.slice(1))!=y&&r.history&&window.history.pushState("photobox",t.title+"-"+e[o][1],window.location.pathname+window.location.search+"#"+encodeURIComponent(y))},load:function(){if(r&&!r.history)return!1;var t=decodeURIComponent(window.location.hash.slice(1));!t&&u.hasClass("show")&&ot();n('a[href="'+t+'"]').trigger("click.photobox")},clear:function(){r.history&&"pushState"in window.history&&window.history.pushState("photobox",t.title,window.location.pathname+window.location.search)}};window.onpopstate=function(){var n=window.onpopstate;return function(t){n&&n.apply(this,arguments);t.state=="photobox"&&et.load()}}();n.event.special.swipe={setup:function(){n(this).bind("touchstart",n.event.special.swipe.handler)},teardown:function(){n(this).unbind("touchstart",n.event.special.swipe.handler)},handler:function(t){function h(){s.removeEventListener("touchmove",c);r=u=null}function c(i){i.preventDefault();var c=r-i.touches[0].pageX,l=u-i.touches[0].pageY;return Math.abs(c)>=20?(h(),e=c>0?-1:1):Math.abs(l)>=20&&(h(),o=l>0?1:-1),t.type="swipe",f.unshift(t,e,o),(n.event.dispatch||n.event.handle).apply(s,f)}var f=[].slice.call(arguments,1),i=t.originalEvent.touches,r,u,e=0,o=0,s=this;t=n.event.fix(t);i.length==1&&(r=i[0].pageX,u=i[0].pageY,this.addEventListener("touchmove",c,!1))}};!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=n(t)["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})});n(t).ready(ui);window._photobox={DOM:{overlay:u},close:ot,history:et,defaults:ri}})(jQuery,document,window);
//# sourceMappingURL=photobox.min.js.map
