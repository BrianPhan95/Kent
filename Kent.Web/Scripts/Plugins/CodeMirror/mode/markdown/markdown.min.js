(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],n):n(CodeMirror)})(function(n){"use strict";n.defineMode("markdown",function(t,i){function tt(i){var r,u;return n.findModeByName&&(r=n.findModeByName(i),r&&(i=r.mime||r.mimes[0])),u=n.getMode(t,i),u.name=="null"?null:u}function a(n,t,i){return t.f=t.inline=i,i(n,t)}function ot(n,t,i){return t.f=t.block=i,i(n,t)}function v(n){return!n||!/\S/.test(n.string)}function k(n){return n.linkTitle=!1,n.em=!1,n.strong=!1,n.strikethrough=!1,n.quote=0,n.indentedCode=!1,c||n.f!=y||(n.f=f,n.block=o),n.trailingSpace=0,n.trailingSpaceNewLine=!1,n.prevLine=n.thisLine,n.thisLine=null,null}function o(n,t){var h=n.sol(),o=t.list!==!1,s=t.indentedCode,f,e;if(t.indentedCode=!1,o&&(t.indentationDiff>=0?(t.indentationDiff<4&&(t.indentation-=t.indentationDiff),t.list=null):t.indentation>0?(t.list=null,t.listDepth=Math.floor(t.indentation/4)):(t.list=!1,t.listDepth=0)),f=null,t.indentationDiff>=4)return n.skipToEnd(),s||v(t.prevLine)?(t.indentation-=4,t.indentedCode=!0,u.code):null;if(n.eatSpace())return null;if((f=n.match(rt))&&f[1].length<=6)return t.header=f[1].length,i.highlightFormatting&&(t.formatting="header"),t.f=t.inline,r(t);if(v(t.prevLine)||t.quote||o||s||!(f=n.match(ut))){if(n.eat(">"))return t.quote=h?1:t.quote+1,i.highlightFormatting&&(t.formatting="quote"),n.eatSpace(),r(t);if(n.peek()==="[")return a(n,t,at);if(n.match(it,!0))return t.hr=!0,u.hr;if((v(t.prevLine)||o)&&(n.match(p,!1)||n.match(w,!1)))return e=null,n.match(p,!0)?e="ul":(n.match(w,!0),e="ol"),t.indentation=n.column()+n.current().length,t.list=!0,t.listDepth++,i.taskLists&&n.match(b,!1)&&(t.taskList=!0),t.f=t.inline,i.highlightFormatting&&(t.formatting=["list","list-"+e]),r(t);if(i.fencedCodeBlocks&&(f=n.match(et,!0)))return t.fencedChars=f[1],t.localMode=tt(f[2]),t.localMode&&(t.localState=t.localMode.startState()),t.f=t.block=st,i.highlightFormatting&&(t.formatting="code-block"),t.code=!0,r(t)}else return t.header=f[0].charAt(0)=="="?1:2,i.highlightFormatting&&(t.formatting="header"),t.f=t.inline,r(t);return a(n,t,t.inline)}function y(n,t){var i=s.token(n,t.htmlState);return(c&&t.htmlState.tagStart===null&&!t.htmlState.context&&t.htmlState.tokenize.isInText||t.md_inside&&n.current().indexOf(">")>-1)&&(t.f=f,t.block=o,t.htmlState=null),i}function st(n,t){return n.sol()&&t.fencedChars&&n.match(t.fencedChars,!1)?(t.localMode=t.localState=null,t.f=t.block=ht,null):t.localMode?t.localMode.token(n,t.localState):(n.skipToEnd(),u.code)}function ht(n,t){n.match(t.fencedChars);t.block=o;t.f=f;t.fencedChars=null;i.highlightFormatting&&(t.formatting="code-block");t.code=!0;var u=r(t);return t.code=!1,u}function r(n){var t=[],r,f;if(n.formatting)for(t.push(u.formatting),typeof n.formatting=="string"&&(n.formatting=[n.formatting]),r=0;r<n.formatting.length;r++)t.push(u.formatting+"-"+n.formatting[r]),n.formatting[r]==="header"&&t.push(u.formatting+"-"+n.formatting[r]+"-"+n.header),n.formatting[r]==="quote"&&(!i.maxBlockquoteDepth||i.maxBlockquoteDepth>=n.quote?t.push(u.formatting+"-"+n.formatting[r]+"-"+n.quote):t.push("error"));return n.taskOpen?(t.push("meta"),t.length?t.join(" "):null):n.taskClosed?(t.push("property"),t.length?t.join(" "):null):(n.linkHref?t.push(u.linkHref,"url"):(n.strong&&t.push(u.strong),n.em&&t.push(u.em),n.strikethrough&&t.push(u.strikethrough),n.linkText&&t.push(u.linkText),n.code&&t.push(u.code)),n.header&&t.push(u.header,u.header+"-"+n.header),n.quote&&(t.push(u.quote),!i.maxBlockquoteDepth||i.maxBlockquoteDepth>=n.quote?t.push(u.quote+"-"+n.quote):t.push(u.quote+"-"+i.maxBlockquoteDepth)),n.list!==!1&&(f=(n.listDepth-1)%3,f?f===1?t.push(u.list2):t.push(u.list3):t.push(u.list1)),n.trailingSpaceNewLine?t.push("trailing-space-new-line"):n.trailingSpace&&t.push("trailing-space-"+(n.trailingSpace%2?"a":"b")),t.length?t.join(" "):null)}function ct(n,t){return n.match(ft,!0)?r(t):undefined}function f(t,f){var tt=f.text(t,f),it,rt,e,a,c,ut,ft,et,v,o,p,st,w,k,nt,h;if(typeof tt!="undefined")return tt;if(f.list)return f.list=null,r(f);if(f.taskList)return it=t.match(b,!0)[1]!=="x",it?f.taskOpen=!0:f.taskClosed=!0,i.highlightFormatting&&(f.formatting="task"),f.taskList=!1,r(f);if(f.taskOpen=!1,f.taskClosed=!1,f.header&&t.match(/^#+$/,!0))return i.highlightFormatting&&(f.formatting="header"),r(f);if(rt=t.sol(),e=t.next(),e==="\\"&&(t.next(),i.highlightFormatting))return o=r(f),a=u.formatting+"-escape",o?o+" "+a:a;if(f.linkTitle&&(f.linkTitle=!1,c=e,e==="("&&(c=")"),c=(c+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),ut="^\\s*(?:[^"+c+"\\\\]+|\\\\\\\\|\\\\.)"+c,t.match(new RegExp(ut),!0)))return u.linkHref;if(e==="`")return ft=f.formatting,i.highlightFormatting&&(f.formatting="code"),h=r(f),et=t.pos,t.eatWhile("`"),v=1+t.pos-et,f.code?v===l?(f.code=!1,h):(f.formatting=ft,r(f)):(l=v,f.code=!0,r(f));if(f.code)return r(f);if(e==="!"&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return t.match(/\[[^\]]*\]/),f.inline=f.f=g,u.image;if(e==="["&&t.match(/.*\](\(.*\)| ?\[.*\])/,!1))return f.linkText=!0,i.highlightFormatting&&(f.formatting="link"),r(f);if(e==="]"&&f.linkText&&t.match(/\(.*\)| ?\[.*\]/,!1))return i.highlightFormatting&&(f.formatting="link"),o=r(f),f.linkText=!1,f.inline=f.f=g,o;if(e==="<"&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return f.f=f.inline=d,i.highlightFormatting&&(f.formatting="link"),o=r(f),o?o+=" ":o="",o+u.linkInline;if(e==="<"&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return f.f=f.inline=d,i.highlightFormatting&&(f.formatting="link"),o=r(f),o?o+=" ":o="",o+u.linkEmail;if(e==="<"&&t.match(/^(!--|\w)/,!1))return p=t.string.indexOf(">",t.pos),p!=-1&&(st=t.string.substring(t.start,p),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(st)&&(f.md_inside=!0)),t.backUp(1),f.htmlState=n.startState(s),ot(t,f,y);if(e==="<"&&t.match(/^\/\w*?>/))return f.md_inside=!1,"tag";if(w=!1,i.underscoresBreakWords||e==="_"&&t.peek()!=="_"&&t.match(/(\w)/,!1)&&(k=t.pos-2,k>=0&&(nt=t.string.charAt(k),nt!=="_"&&nt.match(/(\w)/,!1)&&(w=!0))),e!=="*"&&(e!=="_"||w)){if(e===" "&&(t.eat("*")||t.eat("_"))){if(t.peek()===" ")return r(f);t.backUp(1)}}else if(!rt||t.peek()!==" "){if(f.strong===e&&t.eat(e))return i.highlightFormatting&&(f.formatting="strong"),h=r(f),f.strong=!1,h;if(!f.strong&&t.eat(e))return f.strong=e,i.highlightFormatting&&(f.formatting="strong"),r(f);if(f.em===e)return i.highlightFormatting&&(f.formatting="em"),h=r(f),f.em=!1,h;if(!f.em)return f.em=e,i.highlightFormatting&&(f.formatting="em"),r(f)}if(i.strikethrough)if(e==="~"&&t.eatWhile(e)){if(f.strikethrough)return i.highlightFormatting&&(f.formatting="strikethrough"),h=r(f),f.strikethrough=!1,h;if(t.match(/^[^\s]/,!1))return f.strikethrough=!0,i.highlightFormatting&&(f.formatting="strikethrough"),r(f)}else if(e===" "&&t.match(/^~~/,!0)){if(t.peek()===" ")return r(f);t.backUp(2)}return e===" "&&(t.match(/ +$/,!1)?f.trailingSpace++:f.trailingSpace&&(f.trailingSpaceNewLine=!0)),r(f)}function d(n,t){var o=n.next(),e;return o===">"?(t.f=t.inline=f,i.highlightFormatting&&(t.formatting="link"),e=r(t),e?e+=" ":e="",e+u.linkInline):(n.match(/^[^>]+/,!0),u.linkInline)}function g(n,t){if(n.eatSpace())return null;var u=n.next();return u==="("||u==="["?(t.f=t.inline=lt(u==="("?")":"]"),i.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,r(t)):"error"}function lt(n){return function(t,u){var o=t.next(),e;return o===n?(u.f=u.inline=f,i.highlightFormatting&&(u.formatting="link-string"),e=r(u),u.linkHref=!1,e):(t.match(pt(n),!0)&&t.backUp(1),u.linkHref=!0,r(u))}}function at(n,t){return n.match(/^[^\]]*\]:/,!1)?(t.f=vt,n.next(),i.highlightFormatting&&(t.formatting="link"),t.linkText=!0,r(t)):a(n,t,f)}function vt(n,t){if(n.match(/^\]:/,!0)){t.f=t.inline=yt;i.highlightFormatting&&(t.formatting="link");var f=r(t);return t.linkText=!1,f}return n.match(/^[^\]]+/,!0),u.linkText}function yt(n,t){return n.eatSpace()?null:(n.match(/^[^\s]+/,!0),n.peek()===undefined?t.linkTitle=!0:n.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=f,u.linkHref+" url")}function pt(n){return h[n]||(n=(n+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),h[n]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+n+")")),h[n]}var c=n.modes.hasOwnProperty("xml"),s=n.getMode(t,c?{name:"xml",htmlMode:!0}:"text/plain"),l,u,e,h,nt;i.highlightFormatting===undefined&&(i.highlightFormatting=!1);i.maxBlockquoteDepth===undefined&&(i.maxBlockquoteDepth=0);i.underscoresBreakWords===undefined&&(i.underscoresBreakWords=!0);i.taskLists===undefined&&(i.taskLists=!1);i.strikethrough===undefined&&(i.strikethrough=!1);i.tokenTypeOverrides===undefined&&(i.tokenTypeOverrides={});l=0;u={header:"header",code:"comment",quote:"quote",list1:"variable-2",list2:"variable-3",list3:"keyword",hr:"hr",image:"tag",formatting:"formatting",linkInline:"link",linkEmail:"link",linkText:"link",linkHref:"string",em:"em",strong:"strong",strikethrough:"strikethrough"};for(e in u)u.hasOwnProperty(e)&&i.tokenTypeOverrides[e]&&(u[e]=i.tokenTypeOverrides[e]);var it=/^([*\-_])(?:\s*\1){2,}\s*$/,p=/^[*\-+]\s+/,w=/^[0-9]+([.)])\s+/,b=/^\[(x| )\](?=\s)/,rt=i.allowAtxHeaderWithoutSpace?/^(#+)/:/^(#+)(?: |$)/,ut=/^ *(?:\={1,}|-{1,})\s*$/,ft=/^[^#!\[\]*_\\<>` "'(~]+/,et=new RegExp("^("+(i.fencedCodeBlocks===!0?"~~~+|```+":i.fencedCodeBlocks)+")[ \\t]*([\\w+#]*)");return h=[],nt={startState:function(){return{f:o,prevLine:null,thisLine:null,block:o,htmlState:null,indentation:0,inline:f,text:ct,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1,fencedChars:null}},copyState:function(t){return{f:t.f,prevLine:t.prevLine,thisLine:t.thisLine,block:t.block,htmlState:t.htmlState&&n.copyState(s,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?n.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,formatting:!1,linkTitle:t.linkTitle,code:t.code,em:t.em,strong:t.strong,strikethrough:t.strikethrough,header:t.header,hr:t.hr,taskList:t.taskList,list:t.list,listDepth:t.listDepth,quote:t.quote,indentedCode:t.indentedCode,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside,fencedChars:t.fencedChars}},token:function(n,t){var r,u,i,f;if(t.formatting=!1,n!=t.thisLine){if(r=t.header||t.hr,t.header=0,t.hr=!1,n.match(/^\s*$/,!0)||r){if(k(t),!r)return null;t.prevLine=null}if(t.prevLine=t.thisLine,t.thisLine=n,t.taskList=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block,u=n.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,i=Math.floor((u-t.indentation)/4)*4,i>4&&(i=4),f=t.indentation+i,t.indentationDiff=f-t.indentation,t.indentation=f,u>0)return null}return t.f(n,t)},innerMode:function(n){return n.block==y?{state:n.htmlState,mode:s}:n.localState?{state:n.localState,mode:n.localMode}:{state:n,mode:nt}},blankLine:k,getType:r,fold:"markdown"}},"xml");n.defineMIME("text/x-markdown","markdown")});
//# sourceMappingURL=markdown.min.js.map
