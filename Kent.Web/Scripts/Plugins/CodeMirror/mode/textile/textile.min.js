(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function c(n,t){t.mode=r.newLayout;t.tableHeading=!1;t.layoutType==="definitionList"&&t.spanningLayout&&n.match(i("definitionListEnd"),!1)&&(t.spanningLayout=!1)}function h(n,t,i){var r,s;return i==="_"?n.eat("_")?e(n,t,"italic",/__/,2):e(n,t,"em",/_/,1):i==="*"?n.eat("*")?e(n,t,"bold",/\*\*/,2):e(n,t,"strong",/\*/,1):i==="["?(n.match(/\d+\]/)&&(t.footCite=!0),u(t)):i==="("&&(r=n.match(/^(r|tm|c)\)/),r)?o(t,f.specialChar):i==="<"&&n.match(/(\w+)[^>]+>[^<]+<\/\1>/)?o(t,f.html):i==="?"&&n.eat("?")?e(n,t,"cite",/\?\?/,2):i==="="&&n.eat("=")?e(n,t,"notextile",/==/,2):i==="-"&&!n.eat("-")?e(n,t,"deletion",/-/,1):i==="+"?e(n,t,"addition",/\+/,1):i==="~"?e(n,t,"sub",/~/,1):i==="^"?e(n,t,"sup",/\^/,1):i==="%"?e(n,t,"span",/%/,1):i==="@"?e(n,t,"code",/@/,1):i==="!"?(s=e(n,t,"image",/(?:\([^\)]+\))?!/,1),n.match(/^:\S+/),s):u(t)}function e(n,t,i,f,e){var o=n.pos>e?n.string.charAt(n.pos-e-1):null,s=n.peek(),h;if(t[i]){if((!s||/\W/.test(s))&&o&&/\S/.test(o))return h=u(t),t[i]=!1,h}else(!o||/\W/.test(o))&&s&&/\S/.test(s)&&n.match(new RegExp("^.*\\S"+f.source+"(?:\\W|$)"),!1)&&(t[i]=!0,t.mode=r.attributes);return u(t)}function u(n){var i=s(n),t;return i?i:(t=[],n.layoutType&&t.push(f[n.layoutType]),t=t.concat(l(n,"addition","bold","cite","code","deletion","em","footCite","image","italic","link","span","strong","sub","sup","table","tableHeading")),n.layoutType==="header"&&t.push(f.header+"-"+n.header),t.length?t.join(" "):null)}function s(n){var t=n.layoutType;switch(t){case"notextile":case"code":case"pre":return f[t];default:return n.notextile?f.notextile+(t?" "+f[t]:""):null}}function o(n,t){var r=s(n),i;return r?r:(i=u(n),t?i?i+" "+t:t:i)}function l(n){for(var i=[],t=1;t<arguments.length;++t)n[arguments[t]]&&i.push(f[arguments[t]]);return i}function a(n){var i=n.spanningLayout,u=n.layoutType;for(var t in n)n.hasOwnProperty(t)&&delete n[t];n.mode=r.newLayout;i&&(n.layoutType=u,n.spanningLayout=!0)}function i(n){return t.cache[n]||(t.cache[n]=t.createRe(n))}var f={addition:"positive",attributes:"attribute",bold:"strong",cite:"keyword",code:"atom",definitionList:"number",deletion:"negative",div:"punctuation",em:"em",footnote:"variable",footCite:"qualifier",header:"header",html:"comment",image:"string",italic:"em",link:"link",linkDefinition:"link",list1:"variable-2",list2:"variable-3",list3:"keyword",notextile:"string-2",pre:"operator",p:"property",quote:"bracket",span:"quote",specialChar:"tag",strong:"strong",sub:"builtin",sup:"builtin",table:"variable-3",tableHeading:"operator"},t={cache:{},single:{bc:"bc",bq:"bq",definitionList:/- [^(?::=)]+:=+/,definitionListEnd:/.*=:\s*$/,div:"div",drawTable:/\|.*\|/,foot:/fn\d+/,header:/h[1-6]/,html:/\s*<(?:\/)?(\w+)(?:[^>]+)?>(?:[^<]+<\/\1>)?/,link:/[^"]+":\S/,linkDefinition:/\[[^\s\]]+\]\S+/,list:/(?:#+|\*+)/,notextile:"notextile",para:"p",pre:"pre",table:"table",tableCellAttributes:/[\/\\]\d+/,tableHeading:/\|_\./,tableText:/[^"_\*\[\(\?\+~\^%@|-]+/,text:/[^!"_=\*\[\(<\?\+~\^%@-]+/},attributes:{align:/(?:<>|<|>|=)/,selector:/\([^\(][^\)]+\)/,lang:/\[[^\[\]]+\]/,pad:/(?:\(+|\)+){1,2}/,css:/\{[^\}]+\}/},createRe:function(n){switch(n){case"drawTable":return t.makeRe("^",t.single.drawTable,"$");case"html":return t.makeRe("^",t.single.html,"(?:",t.single.html,")*","$");case"linkDefinition":return t.makeRe("^",t.single.linkDefinition,"$");case"listLayout":return t.makeRe("^",t.single.list,i("allAttributes"),"*\\s+");case"tableCellAttributes":return t.makeRe("^",t.choiceRe(t.single.tableCellAttributes,i("allAttributes")),"+\\.");case"type":return t.makeRe("^",i("allTypes"));case"typeLayout":return t.makeRe("^",i("allTypes"),i("allAttributes"),"*\\.\\.?","(\\s+|$)");case"attributes":return t.makeRe("^",i("allAttributes"),"+");case"allTypes":return t.choiceRe(t.single.div,t.single.foot,t.single.header,t.single.bc,t.single.bq,t.single.notextile,t.single.pre,t.single.table,t.single.para);case"allAttributes":return t.choiceRe(t.attributes.selector,t.attributes.css,t.attributes.lang,t.attributes.align,t.attributes.pad);default:return t.makeRe("^",t.single[n])}},makeRe:function(){for(var n,i="",t=0;t<arguments.length;++t)n=arguments[t],i+=typeof n=="string"?n:n.source;return new RegExp(i)},choiceRe:function(){for(var n=[arguments[0]],i=1;i<arguments.length;++i)n[i*2-1]="|",n[i*2]=arguments[i];return n.unshift("(?:"),n.push(")"),t.makeRe.apply(null,n)}},r={newLayout:function(n,t){if(n.match(i("typeLayout"),!1))return t.spanningLayout=!1,(t.mode=r.blockType)(n,t);var u;return s(t)||(n.match(i("listLayout"),!1)?u=r.list:n.match(i("drawTable"),!1)?u=r.table:n.match(i("linkDefinition"),!1)?u=r.linkDefinition:n.match(i("definitionList"))?u=r.definitionList:n.match(i("html"),!1)&&(u=r.html)),(t.mode=u||r.text)(n,t)},blockType:function(n,t){var e,f;if(t.layoutType=null,e=n.match(i("type")))f=e[0];else return(t.mode=r.text)(n,t);return(e=f.match(i("header")))?(t.layoutType="header",t.header=parseInt(e[0][1])):f.match(i("bq"))?t.layoutType="quote":f.match(i("bc"))?t.layoutType="code":f.match(i("foot"))?t.layoutType="footnote":f.match(i("notextile"))?t.layoutType="notextile":f.match(i("pre"))?t.layoutType="pre":f.match(i("div"))?t.layoutType="div":f.match(i("table"))&&(t.layoutType="table"),t.mode=r.attributes,u(t)},text:function(n,t){if(n.match(i("text")))return u(t);var f=n.next();return f==='"'?(t.mode=r.link)(n,t):h(n,t,f)},attributes:function(n,t){return t.mode=r.layoutLength,n.match(i("attributes"))?o(t,f.attributes):u(t)},layoutLength:function(n,t){return n.eat(".")&&n.eat(".")&&(t.spanningLayout=!0),t.mode=r.text,u(t)},list:function(n,t){var e=n.match(i("list")),f;return t.listDepth=e[0].length,f=(t.listDepth-1)%3,t.layoutType=f?f===1?"list2":"list3":"list1",t.mode=r.attributes,u(t)},link:function(n,t){return(t.mode=r.text,n.match(i("link")))?(n.match(/\S+/),o(t,f.link)):u(t)},linkDefinition:function(n,t){return n.skipToEnd(),o(t,f.linkDefinition)},definitionList:function(n,t){return n.match(i("definitionList")),t.layoutType="definitionList",n.match(/\s*$/)?t.spanningLayout=!0:t.mode=r.attributes,u(t)},html:function(n,t){return n.skipToEnd(),o(t,f.html)},table:function(n,t){return t.layoutType="table",(t.mode=r.tableCell)(n,t)},tableCell:function(n,t){return n.match(i("tableHeading"))?t.tableHeading=!0:n.eat("|"),t.mode=r.tableCellAttributes,u(t)},tableCellAttributes:function(n,t){return t.mode=r.tableText,n.match(i("tableCellAttributes"))?o(t,f.attributes):u(t)},tableText:function(n,t){return n.match(i("tableText"))?u(t):n.peek()==="|"?(t.mode=r.tableCell,u(t)):h(n,t,n.next())}};n.defineMode("textile",function(){return{startState:function(){return{mode:r.newLayout}},token:function(n,t){return n.sol()&&c(n,t),t.mode(n,t)},blankLine:a}});n.defineMIME("text/x-textile","textile")});
//# sourceMappingURL=textile.min.js.map
