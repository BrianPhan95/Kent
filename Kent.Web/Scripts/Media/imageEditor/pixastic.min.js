var Pixastic=function(){function f(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)}function e(n){var r=!1,i=function(){r||(r=!0,n())},t;document.write('<script defer src="//:" id="__onload_ie_pixastic__"><\/script>');t=document.getElementById("__onload_ie_pixastic__");t.onreadystatechange=function(){t.readyState=="complete"&&(t.parentNode.removeChild(t),i())};document.addEventListener&&document.addEventListener("DOMContentLoaded",i,!1);f(window,"load",i)}function o(){for(var r=t("pixastic",null,"img"),u=t("pixastic",null,"canvas"),i=r.concat(u),n=0;n<i.length;n++)(function(){for(var o,s,u,f,h,t=i[n],r=[],c=t.className.split(" "),e=0;e<c.length;e++)o=c[e],o.substring(0,9)=="pixastic-"&&(s=o.substring(9),s!=""&&r.push(s));if(r.length)if(t.tagName.toLowerCase()=="img")if(u=new Image,u.src=t.src,u.complete)for(f=0;f<r.length;f++)h=Pixastic.applyAction(t,t,r[f],null),h&&(t=h);else u.onload=function(){for(var i,n=0;n<r.length;n++)i=Pixastic.applyAction(t,t,r[n],null),i&&(t=i)};else setTimeout(function(){for(var i,n=0;n<r.length;n++)i=Pixastic.applyAction(t,t,r[n],null),i&&(t=i)},1)})()}function t(n,t,r){var f=[];t==null&&(t=document);r==null&&(r="*");var u=t.getElementsByTagName(r),e=u.length,o=new RegExp("(^|\\s)"+n+"(\\s|$)");for(i=0,j=0;i<e;i++)o.test(u[i].className)&&(f[j]=u[i],j++);return f}function n(n,t){if(Pixastic.debug){try{switch(t){case"warn":console.warn("Pixastic:",n);break;case"error":console.error("Pixastic:",n);break;default:console.log("Pixastic:",n)}}catch(i){}!s}}var s;typeof pixastic_parseonload!="undefined"&&pixastic_parseonload&&e(o);var r=function(){var n=document.createElement("canvas"),t=!1;try{t=!!(typeof n.getContext=="function"&&n.getContext("2d"))}catch(i){}return function(){return t}}(),u=function(){var n=document.createElement("canvas"),t=!1,i;try{typeof n.getContext=="function"&&(i=n.getContext("2d"))&&(t=typeof i.getImageData=="function")}catch(r){}return function(){return t}}(),h=function(){var e=!1,i=document.createElement("canvas"),n,t,f,o;return r()&&u()&&(i.width=i.height=1,n=i.getContext("2d"),n.fillStyle="rgb(255,0,0)",n.fillRect(0,0,1,1),t=document.createElement("canvas"),t.width=t.height=1,f=t.getContext("2d"),f.fillStyle="rgb(0,0,255)",f.fillRect(0,0,1,1),n.globalAlpha=.5,n.drawImage(t,0,0),o=n.getImageData(0,0,1,1).data,e=o[2]!=255),function(){return e}}();return{parseOnLoad:!1,debug:!1,applyAction:function(t,i,r,u){var h,f,w,y,e,o,b,k,l,s,a,c,p,v,d;if(u=u||{},h=t.tagName.toLowerCase()=="canvas",h&&Pixastic.Client.isIE())return Pixastic.debug&&n("Tried to process a canvas element but browser is IE."),!1;if(y=!1,Pixastic.Client.hasCanvas()&&(y=!!u.resultCanvas,f=u.resultCanvas||document.createElement("canvas"),w=f.getContext("2d")),e=t.naturalWidth,o=t.naturalHeight,h&&(e=t.width,o=t.height),e==0||o==0)if(t.parentNode!=null)b=t.style.position,k=t.style.left,t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),e=t.naturalWidth,o=t.naturalHeight,document.body.removeChild(t),t.style.position=b,t.style.left=k;else{Pixastic.debug&&n("Image has 0 width and/or height.");return}if(r.indexOf("(")>-1&&(l=r,r=l.substr(0,l.indexOf("(")),s=l.match(/\((.*?)\)/),s[1]))for(s=s[1].split(";"),a=0;a<s.length;a++)thisArg=s[a].split("="),thisArg.length==2&&(thisArg[0]=="rect"?(c=thisArg[1].split(","),u[thisArg[0]]={left:parseInt(c[0],10)||0,top:parseInt(c[1],10)||0,width:parseInt(c[2],10)||0,height:parseInt(c[3],10)||0}):u[thisArg[0]]=thisArg[1]);return(u.rect?(u.rect.left=Math.round(u.rect.left),u.rect.top=Math.round(u.rect.top),u.rect.width=Math.round(u.rect.width),u.rect.height=Math.round(u.rect.height)):u.rect={left:0,top:0,width:e,height:o},p=!1,Pixastic.Actions[r]&&typeof Pixastic.Actions[r].process=="function"&&(p=!0),!p)?(Pixastic.debug&&n('Invalid action "'+r+'". Maybe file not included?'),!1):Pixastic.Actions[r].checkSupport()?(Pixastic.Client.hasCanvas()?(f!==t&&(f.width=e,f.height=o),y||(f.style.width=e+"px",f.style.height=o+"px"),w.drawImage(i,0,0,e,o),t.__pixastic_org_image?(f.__pixastic_org_image=t.__pixastic_org_image,f.__pixastic_org_width=t.__pixastic_org_width,f.__pixastic_org_height=t.__pixastic_org_height):(f.__pixastic_org_image=t,f.__pixastic_org_width=e,f.__pixastic_org_height=o)):Pixastic.Client.isIE()&&typeof t.__pixastic_org_style=="undefined"&&(t.__pixastic_org_style=t.style.cssText),v={image:t,canvas:f,width:e,height:o,useData:!0,options:u},d=Pixastic.Actions[r].process(v),!d)?!1:Pixastic.Client.hasCanvas()?(v.useData&&Pixastic.Client.hasCanvasImageData()&&(f.getContext("2d").putImageData(v.canvasData,u.rect.left,u.rect.top),f.getContext("2d").fillRect(0,0,0,0)),u.leaveDOM||(f.title=t.title,f.imgsrc=t.imgsrc,h||(f.alt=t.alt),h||(f.imgsrc=t.src),f.className=t.className,f.style.cssText=t.style.cssText,f.name=t.name,f.tabIndex=t.tabIndex,f.id=t.id,t.parentNode&&t.parentNode.replaceChild&&t.parentNode.replaceChild(f,t)),u.resultCanvas=f,u.done&&u.done(f.toDataURL()),f):t:(Pixastic.debug&&n('Action "'+r+'" not supported by this browser.'),!1)},prepareData:function(n,t){var u=n.canvas.getContext("2d"),i=n.options.rect,r=u.getImageData(i.left,i.top,i.width,i.height),f=r.data;return t||(n.canvasData=r),f},process:function(n,t,i,r){var u,f;if(n.tagName.toLowerCase()=="img"){if(u=new Image,u.src=n.src,u.complete)return f=Pixastic.applyAction(n,u,t,i),r&&r(f),f;u.onload=function(){var f=Pixastic.applyAction(n,u,t,i);r&&r(f)}}if(n.tagName.toLowerCase()=="canvas")return f=Pixastic.applyAction(n,n,t,i),r&&r(f),f},revert:function(n){if(Pixastic.Client.hasCanvas()){if(n.tagName.toLowerCase()=="canvas"&&n.__pixastic_org_image)return n.width=n.__pixastic_org_width,n.height=n.__pixastic_org_height,n.getContext("2d").drawImage(n.__pixastic_org_image,0,0),n.parentNode&&n.parentNode.replaceChild&&n.parentNode.replaceChild(n.__pixastic_org_image,n),n}else Pixastic.Client.isIE()&&typeof n.__pixastic_org_style!="undefined"&&(n.style.cssText=n.__pixastic_org_style)},Client:{hasCanvas:r,hasCanvasImageData:u,hasGlobalAlpha:h,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();typeof jQuery!="undefined"&&jQuery&&jQuery.fn&&(jQuery.fn.pixastic=function(n,t){var i=[];return this.each(function(){if(this.tagName.toLowerCase()!="img"||this.complete){var r=Pixastic.process(this,n,t);r&&i.push(r)}}),i.length>0?jQuery(i):this});Pixastic.Actions.blend={process:function(n){var nt=parseFloat(n.options.amount),lt=(n.options.mode||"normal").toLowerCase(),ot=n.options.image,tt,ut,e,it;if(nt=Math.max(0,Math.min(1,nt)),!ot)return!1;if(Pixastic.Client.hasCanvasImageData()){var d=n.options.rect,r=Pixastic.prepareData(n),st=d.width,ht=d.height;n.useData=!1;tt=document.createElement("canvas");tt.width=n.canvas.width;tt.height=n.canvas.height;ut=tt.getContext("2d");ut.drawImage(ot,0,0);var ct={canvas:tt,options:n.options},t=Pixastic.prepareData(ct),at=ct.canvasData,s=st*ht,i=s*4,u,f,o,v,w,a,p,b,h,c,l,k,g,rt,y=!1;switch(lt){case"multiply":while(s--)t[i-=4]=r[i]*t[i]/255,t[u=i+1]=r[u]*t[u]/255,t[f=i+2]=r[f]*t[f]/255;y=!0;break;case"lighten":while(s--)(o=r[i-=4])>t[i]&&(t[i]=o),(v=r[u=i+1])>t[u]&&(t[u]=v),(w=r[f=i+2])>t[f]&&(t[f]=w);y=!0;break;case"darken":while(s--)(o=r[i-=4])<t[i]&&(t[i]=o),(v=r[u=i+1])<t[u]&&(t[u]=v),(w=r[f=i+2])<t[f]&&(t[f]=w);y=!0;break;case"darkercolor":while(s--)(o=r[i-=4])*.3+(v=r[u=i+1])*.59+(w=r[f=i+2])*.11<=t[i]*.3+t[u]*.59+t[f]*.11&&(t[i]=o,t[u]=v,t[f]=w);y=!0;break;case"lightercolor":while(s--)(o=r[i-=4])*.3+(v=r[u=i+1])*.59+(w=r[f=i+2])*.11>t[i]*.3+t[u]*.59+t[f]*.11&&(t[i]=o,t[u]=v,t[f]=w);y=!0;break;case"lineardodge":while(s--)t[i]=(h=r[i-=4]+t[i])>255?255:h,t[u]=(c=r[u=i+1]+t[u])>255?255:c,t[f]=(l=r[f=i+2]+t[f])>255?255:l;y=!0;break;case"linearburn":while(s--)t[i]=(h=r[i-=4]+t[i])<255?0:h-255,t[u]=(c=r[u=i+1]+t[u])<255?0:c-255,t[f]=(l=r[f=i+2]+t[f])<255?0:l-255;y=!0;break;case"difference":while(s--)t[i]=(h=r[i-=4]-t[i])<0?-h:h,t[u]=(c=r[u=i+1]-t[u])<0?-c:c,t[f]=(l=r[f=i+2]-t[f])<0?-l:l;y=!0;break;case"screen":while(s--)t[i-=4]=255-((255-t[i])*(255-r[i])>>8),t[u=i+1]=255-((255-t[u])*(255-r[u])>>8),t[f=i+2]=255-((255-t[f])*(255-r[f])>>8);y=!0;break;case"exclusion":for(e=2/255;s--;)t[i-=4]=(o=r[i])-(o*e-1)*t[i],t[u=i+1]=(v=r[u])-(v*e-1)*t[u],t[f=i+2]=(w=r[f])-(w*e-1)*t[f];y=!0;break;case"overlay":for(e=2/255;s--;)t[i]=(o=r[i-=4])<128?t[i]*o*e:255-(255-t[i])*(255-o)*e,t[u]=(v=r[u=i+1])<128?t[u]*v*e:255-(255-t[u])*(255-v)*e,t[f]=(w=r[f=i+2])<128?t[f]*w*e:255-(255-t[f])*(255-w)*e;y=!0;break;case"softlight":for(e=2/255;s--;)t[i]=(o=r[i-=4])<128?((t[i]>>1)+64)*o*e:255-(191-(t[i]>>1))*(255-o)*e,t[u]=(v=r[u=i+1])<128?((t[u]>>1)+64)*v*e:255-(191-(t[u]>>1))*(255-v)*e,t[f]=(w=r[f=i+2])<128?((t[f]>>1)+64)*w*e:255-(191-(t[f]>>1))*(255-w)*e;y=!0;break;case"hardlight":for(e=2/255;s--;)t[i]=(a=t[i-=4])<128?r[i]*a*e:255-(255-r[i])*(255-a)*e,t[u]=(p=t[u=i+1])<128?r[u]*p*e:255-(255-r[u])*(255-p)*e,t[f]=(b=t[f=i+2])<128?r[f]*b*e:255-(255-r[f])*(255-b)*e;y=!0;break;case"colordodge":while(s--)t[i]=(h=(r[i-=4]<<8)/(255-(a=t[i])))>255||a==255?255:h,t[u]=(c=(r[u=i+1]<<8)/(255-(p=t[u])))>255||p==255?255:c,t[f]=(l=(r[f=i+2]<<8)/(255-(b=t[f])))>255||b==255?255:l;y=!0;break;case"colorburn":while(s--)t[i]=(h=255-(255-r[i-=4]<<8)/t[i])<0||t[i]==0?0:h,t[u]=(c=255-(255-r[u=i+1]<<8)/t[u])<0||t[u]==0?0:c,t[f]=(l=255-(255-r[f=i+2]<<8)/t[f])<0||t[f]==0?0:l;y=!0;break;case"linearlight":while(s--)t[i]=(h=2*(a=t[i-=4])+r[i]-256)<0||a<128&&h<0?0:h>255?255:h,t[u]=(c=2*(p=t[u=i+1])+r[u]-256)<0||p<128&&c<0?0:c>255?255:c,t[f]=(l=2*(b=t[f=i+2])+r[f]-256)<0||b<128&&l<0?0:l>255?255:l;y=!0;break;case"vividlight":while(s--)t[i]=(a=t[i-=4])<128?a?(h=255-(255-r[i]<<8)/(2*a))<0?0:h:0:(h=k=2*a-256)<255?(h=(r[i]<<8)/(255-k))>255?255:h:h<0?0:h,t[u]=(p=t[u=i+1])<128?p?(c=255-(255-r[u]<<8)/(2*p))<0?0:c:0:(c=g=2*p-256)<255?(c=(r[u]<<8)/(255-g))>255?255:c:c<0?0:c,t[f]=(b=t[f=i+2])<128?b?(l=255-(255-r[f]<<8)/(2*b))<0?0:l:0:(l=rt=2*b-256)<255?(l=(r[f]<<8)/(255-rt))>255?255:l:l<0?0:l;y=!0;break;case"pinlight":while(s--)t[i]=(a=t[i-=4])<128?(o=r[i])<(k=2*a)?o:k:(o=r[i])>(k=2*a-256)?o:k,t[u]=(p=t[u=i+1])<128?(v=r[u])<(g=2*p)?v:g:(v=r[u])>(g=2*p-256)?v:g,t[f]=(a=t[f=i+2])<128?(o=r[f])<(k=2*a)?o:k:(o=r[f])>(k=2*a-256)?o:k;y=!0;break;case"hardmix":while(s--)t[i]=(a=t[i-=4])<128?255-(255-r[i]<<8)/(2*a)<128||a==0?0:255:(k=2*a-256)<255&&(r[i]<<8)/(255-k)<128?0:255,t[u]=(p=t[u=i+1])<128?255-(255-r[u]<<8)/(2*p)<128||p==0?0:255:(g=2*p-256)<255&&(r[u]<<8)/(255-g)<128?0:255,t[f]=(b=t[f=i+2])<128?255-(255-r[f]<<8)/(2*b)<128||b==0?0:255:(rt=2*b-256)<255&&(r[f]<<8)/(255-rt)<128?0:255;y=!0}if(y&&ut.putImageData(at,0,0),nt==1||Pixastic.Client.hasGlobalAlpha())it=n.canvas.getContext("2d"),it.save(),it.globalAlpha=nt,it.drawImage(tt,0,0,d.width,d.height,d.left,d.top,d.width,d.height),it.globalAlpha=1,it.restore();else{for(var s=st*ht,ft=nt,et=1-nt;s--;){var i=s*4,vt=r[i]*et+t[i]*ft>>0,yt=r[i+1]*et+t[i+1]*ft>>0,pt=r[i+2]*et+t[i+2]*ft>>0;r[i]=vt;r[i+1]=yt;r[i+2]=pt}n.useData=!0}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.blur={process:function(n){var o,s;if(typeof n.options.fixMargin=="undefined"&&(n.options.fixMargin=!0),Pixastic.Client.hasCanvasImageData()){var h=Pixastic.prepareData(n),t=Pixastic.prepareData(n,!0),y=[[0,1,0],[1,2,1],[0,1,0]],f=0;for(o=0;o<3;o++)for(s=0;s<3;s++)f+=y[o][s];f=1/(f*2);var a=n.options.rect,e=a.width,v=a.height,p=e*4,r=v;do{var w=(r-1)*p,b=r==1?0:r-2,k=r==v?r-1:r,d=b*e*4,g=k*e*4,u=e;do{var i=w+(u*4-4),c=d+(u==1?0:u-2)*4,l=g+(u==e?u-1:u)*4;h[i]=((t[c]+t[i-4]+t[i+4]+t[l])*2+t[i]*4)*f;h[i+1]=((t[c+1]+t[i-3]+t[i+5]+t[l+1])*2+t[i+1]*4)*f;h[i+2]=((t[c+2]+t[i-2]+t[i+6]+t[l+2])*2+t[i+2]*4)*f}while(--u)}while(--r);return!0}if(Pixastic.Client.isIE())return n.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)",n.options.fixMargin&&(n.image.style.marginLeft=(parseInt(n.image.style.marginLeft,10)||0)-2+"px",n.image.style.marginTop=(parseInt(n.image.style.marginTop,10)||0)-2+"px"),!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.blurfast={process:function(n){var u=parseFloat(n.options.amount)||0,v=!!(n.options.clear&&n.options.clear!="false"),t,i,r,h,c,e;if(u=Math.max(0,Math.min(5,u)),Pixastic.Client.hasCanvas()){t=n.options.rect;i=n.canvas.getContext("2d");i.save();i.beginPath();i.rect(t.left,t.top,t.width,t.height);i.clip();var l=2,o=Math.round(n.width/l),s=Math.round(n.height/l),f=document.createElement("canvas");f.width=o;f.height=s;var v=!1,y=Math.round(u*20),a=f.getContext("2d");for(r=0;r<y;r++)h=Math.max(1,Math.round(o-r)),c=Math.max(1,Math.round(s-r)),a.clearRect(0,0,o,s),a.drawImage(n.canvas,0,0,n.width,n.height,0,0,h,c),v&&i.clearRect(t.left,t.top,t.width,t.height),i.drawImage(f,0,0,h,c,0,0,n.width,n.height);return i.restore(),n.useData=!1,!0}if(Pixastic.Client.isIE())return e=10*u,n.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius="+e+")",(n.options.fixMargin||1)&&(n.image.style.marginLeft=(parseInt(n.image.style.marginLeft,10)||0)-Math.round(e)+"px",n.image.style.marginTop=(parseInt(n.image.style.marginTop,10)||0)-Math.round(e)+"px"),!0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.brightness={process:function(n){var f=parseInt(n.options.brightness,10)||0,t=parseFloat(n.options.contrast)||0,o=!!(n.options.legacy&&n.options.legacy!="false"),s,h,c,l;if(o?f=Math.min(150,Math.max(-150,f)):s=1+Math.min(150,Math.max(-150,f))/150,t=Math.max(0,t+1),Pixastic.Client.hasCanvasImageData()){var u=Pixastic.prepareData(n),a=n.options.rect,w=a.width,b=a.height,v=w*b,e=v*4,y,p,i,r;for(t!=1?o?(i=t,r=(f-128)*t+128):(i=s*t,r=-t*128+128):o?(i=1,r=f):(i=s,r=0);v--;)u[e]=(h=u[e-=4]*i+r)>255?255:h<0?0:h,u[y]=(c=u[y=e+1]*i+r)>255?255:c<0?0:c,u[p]=(l=u[p=e+2]*i+r)>255?255:l<0?0:l;return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.coloradjust={process:function(n){var r=parseFloat(n.options.red)||0,u=parseFloat(n.options.green)||0,f=parseFloat(n.options.blue)||0;if(r=Math.round(r*255),u=Math.round(u*255),f=Math.round(f*255),Pixastic.Client.hasCanvasImageData()){for(var t=Pixastic.prepareData(n),h=n.options.rect,c=h.width*h.height,i=c*4,l,a,e,o,s;c--;)i-=4,r&&(t[i]=(e=t[i]+r)<0?0:e>255?255:e),u&&(t[l]=(o=t[l=i+1]+u)<0?0:o>255?255:o),f&&(t[a]=(s=t[a=i+2]+f)<0?0:s>255?255:s);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.colorhistogram={array256:function(n){arr=[];for(var t=0;t<256;t++)arr[t]=n;return arr},process:function(n){var y,r,e,u,f,t,b,o,a,v,i;if(typeof n.options.returnValue!="object"&&(n.options.returnValue={rvals:[],gvals:[],bvals:[]}),y=!!n.options.paint,r=n.options.returnValue,typeof r.values!="array"&&(r.rvals=[],r.gvals=[],r.bvals=[]),Pixastic.Client.hasCanvasImageData()){e=Pixastic.prepareData(n);n.useData=!1;for(var s=this.array256(0),h=this.array256(0),c=this.array256(0),p=n.options.rect,w=p.width*p.height,l=w*4;w--;)s[e[l-=4]]++,h[e[l+1]]++,c[e[l+2]]++;if(r.rvals=s,r.gvals=h,r.bvals=c,y)for(u=n.canvas.getContext("2d"),f=[s,h,c],t=0;t<3;t++){for(b=(t+1)*n.height/3,o=0,i=0;i<256;i++)f[t][i]>o&&(o=f[t][i]);for(a=n.height/3/o,v=n.width/256,t==0?u.fillStyle="rgba(255,0,0,0.5)":t==1?u.fillStyle="rgba(0,255,0,0.5)":t==2&&(u.fillStyle="rgba(0,0,255,0.5)"),i=0;i<256;i++)u.fillRect(i*v,n.height-a*f[t][i]-n.height+b,v,f[t][i]*a)}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.crop={process:function(n){var f;if(Pixastic.Client.hasCanvas()){var e=n.options.rect,t=e.width,i=e.height,r=e.top,u=e.left;return typeof n.options.left!="undefined"&&(u=parseInt(n.options.left,10)),typeof n.options.top!="undefined"&&(r=parseInt(n.options.top,10)),typeof n.options.height!="undefined"&&(t=parseInt(n.options.width,10)),typeof n.options.height!="undefined"&&(i=parseInt(n.options.height,10)),u<0&&(u=0),u>n.width-1&&(u=n.width-1),r<0&&(r=0),r>n.height-1&&(r=n.height-1),t<1&&(t=1),u+t>n.width&&(t=n.width-u),i<1&&(i=1),r+i>n.height&&(i=n.height-r),f=document.createElement("canvas"),f.width=n.width,f.height=n.height,f.getContext("2d").drawImage(n.canvas,0,0),n.canvas.width=t,n.canvas.height=i,n.canvas.getContext("2d").clearRect(0,0,t,i),n.canvas.getContext("2d").drawImage(f,u,r,t,i,0,0,t,i),n.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.desaturate={process:function(n){var o=!!(n.options.average&&n.options.average!="false");if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(n),e=n.options.rect,s=e.width,h=e.height,f=s*h,i=f*4,r,u;if(o)while(f--)t[i-=4]=t[r=i+1]=t[u=i+2]=(t[i]+t[r]+t[u])/3;else while(f--)t[i-=4]=t[r=i+1]=t[u=i+2]=t[i]*.3+t[r]*.59+t[u]*.11;return!0}if(Pixastic.Client.isIE())return n.image.style.filter+=" gray",!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.edges={process:function(n){var b=!!(n.options.mono&&n.options.mono!="false"),y=!!(n.options.invert&&n.options.invert!="false"),h;if(Pixastic.Client.hasCanvasImageData()){var v=Pixastic.prepareData(n),t=Pixastic.prepareData(n,!0),i=-1/8,rt=[[i,i,i],[i,1,i],[i,i,i]];weight=1/i;var p=n.options.rect,a=p.width,w=p.height,k=a*4,c=w;do{var d=(c-1)*k,g=c==w?c-1:c,nt=c==1?0:c-2,tt=nt*a*4,it=g*a*4,l=a;do{var r=d+(l*4-4),u=tt+(l==1?0:l-2)*4,f=it+(l==a?l-1:l)*4,e=((t[u-4]+t[u]+t[u+4]+t[r-4]+t[r+4]+t[f-4]+t[f]+t[f+4])*i+t[r])*weight,o=((t[u-3]+t[u+1]+t[u+5]+t[r-3]+t[r+5]+t[f-3]+t[f+1]+t[f+5])*i+t[r+1])*weight,s=((t[u-2]+t[u+2]+t[u+6]+t[r-2]+t[r+6]+t[f-2]+t[f+2]+t[f+6])*i+t[r+2])*weight;b?(h=e*.3+o*.59+s*.11||0,y&&(h=255-h),h<0&&(h=0),h>255&&(h=255),e=o=s=h):(y&&(e=255-e,o=255-o,s=255-s),e<0&&(e=0),o<0&&(o=0),s<0&&(s=0),e>255&&(e=255),o>255&&(o=255),s>255&&(s=255));v[r]=e;v[r+1]=o;v[r+2]=s}while(--l)}while(--c);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.edges2={process:function(n){var g,nt;if(Pixastic.Client.hasCanvasImageData()){var d=Pixastic.prepareData(n),t=Pixastic.prepareData(n,!0),tt=n.options.rect,it=tt.width,ht=tt.height,h=it*4,f=h+4,ct=ht-1,lt=it-1;for(g=1;g<ct;++g){var i=f-4,r=i-h,u=i+h,rt=-t[r]-t[i]-t[u],ut=-t[++r]-t[++i]-t[++u],ft=-t[++r]-t[++i]-t[++u],c=t[r+=2],l=t[++r],a=t[++r],v=t[i+=2],y=t[++i],p=t[++i],w=t[u+=2],b=t[++u],k=t[++u],et=-c-v-w,ot=-l-y-b,st=-a-p-k;for(nt=1;nt<lt;++nt){i=f+4;r=i-h;u=i+h;var e=127+rt-c-v*-8-w,o=127+ut-l-y*-8-b,s=127+ft-a-p*-8-k;rt=et;ut=ot;ft=st;c=t[r];l=t[++r];a=t[++r];v=t[i];y=t[++i];p=t[++i];w=t[u];b=t[++u];k=t[++u];e+=et=-c-v-w;o+=ot=-l-y-b;s+=st=-a-p-k;e>255&&(e=255);o>255&&(o=255);s>255&&(s=255);e<0&&(e=0);o<0&&(o=0);s<0&&(s=0);d[f]=e;d[++f]=o;d[++f]=s;f+=2}f+=8}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.emboss={process:function(n){var rt=parseFloat(n.options.strength)||1,ut=typeof n.options.greyLevel!="undefined"?parseInt(n.options.greyLevel):180,ft=n.options.direction||"topleft",et=!!(n.options.blend&&n.options.blend!="false"),r=0,u=0,nt,o,tt,s,t,h,c;switch(ft){case"topleft":r=-1;u=-1;break;case"top":r=-1;u=0;break;case"topright":r=-1;u=1;break;case"right":r=0;u=1;break;case"bottomright":r=1;u=1;break;case"bottom":r=1;u=0;break;case"bottomleft":r=1;u=-1;break;case"left":r=0;u=-1}if(Pixastic.Client.hasCanvasImageData()){var f=Pixastic.prepareData(n),e=Pixastic.prepareData(n,!0),lt=!!n.options.invertAlpha,d=n.options.rect,a=d.width,g=d.height,ot=a*4,l=g;do{nt=(l-1)*ot;o=r;l+o<1&&(o=0);l+o>g&&(o=0);tt=(l-1+o)*a*4;s=a;do{t=nt+(s-1)*4;h=u;s+h<1&&(h=0);s+h>a&&(h=0);var p=tt+(s-1+h)*4,st=e[t]-e[p],v=e[t+1]-e[p+1],y=e[t+2]-e[p+2],i=st,it=i>0?i:-i,ht=v>0?v:-v,ct=y>0?y:-y;if(ht>it&&(i=v),ct>it&&(i=y),i*=rt,et){var w=f[t]+i,b=f[t+1]+i,k=f[t+2]+i;f[t]=w>255?255:w<0?0:w;f[t+1]=b>255?255:b<0?0:b;f[t+2]=k>255?255:k<0?0:k}else c=ut-i,c<0?c=0:c>255&&(c=255),f[t]=f[t+1]=f[t+2]=c}while(--s)}while(--l);return!0}if(Pixastic.Client.isIE())return n.image.style.filter+=" progid:DXImageTransform.Microsoft.emboss()",!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.flip={process:function(n){var t=n.options.rect,r=document.createElement("canvas"),i;return r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(n.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height),i=n.canvas.getContext("2d"),i.clearRect(t.left,t.top,t.width,t.height),n.options.axis=="horizontal"?(i.scale(-1,1),i.drawImage(r,-t.left-t.width,t.top,t.width,t.height)):(i.scale(1,-1),i.drawImage(r,t.left,-t.top-t.height,t.width,t.height)),n.useData=!1,!0},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.fliph={process:function(n){var t,i,r;return Pixastic.Client.hasCanvas()?(t=n.options.rect,i=document.createElement("canvas"),i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(n.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height),r=n.canvas.getContext("2d"),r.clearRect(t.left,t.top,t.width,t.height),r.scale(-1,1),r.drawImage(i,-t.left-t.width,t.top,t.width,t.height),n.useData=!1,!0):Pixastic.Client.isIE()?(n.image.style.filter+=" fliph",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.flipv={process:function(n){var t,i,r;return Pixastic.Client.hasCanvas()?(t=n.options.rect,i=document.createElement("canvas"),i.width=t.width,i.height=t.height,i.getContext("2d").drawImage(n.image,t.left,t.top,t.width,t.height,0,0,t.width,t.height),r=n.canvas.getContext("2d"),r.clearRect(t.left,t.top,t.width,t.height),r.scale(1,-1),r.drawImage(i,t.left,-t.top-t.height,t.width,t.height),n.useData=!1,!0):Pixastic.Client.isIE()?(n.image.style.filter+=" flipv",!0):void 0},checkSupport:function(){return Pixastic.Client.hasCanvas()||Pixastic.Client.isIE()}};Pixastic.Actions.glow={process:function(n){var u=parseFloat(n.options.amount)||0,s=parseFloat(n.options.radius)||0,h,t,e,f,a,v;if(u=Math.min(1,Math.max(0,u)),s=Math.min(5,Math.max(0,s)),Pixastic.Client.hasCanvasImageData()){h=n.options.rect;t=document.createElement("canvas");t.width=n.width;t.height=n.height;e=t.getContext("2d");e.drawImage(n.canvas,0,0);var b=2,c=Math.round(n.width/b),l=Math.round(n.height/b),o=document.createElement("canvas");o.width=c;o.height=l;var g=Math.round(s*20),k=o.getContext("2d");for(f=0;f<g;f++)a=Math.max(1,Math.round(c-f)),v=Math.max(1,Math.round(l-f)),k.clearRect(0,0,c,l),k.drawImage(t,0,0,n.width,n.height,0,0,a,v),e.clearRect(0,0,n.width,n.height),e.drawImage(o,0,0,a,v,0,0,n.width,n.height);for(var i=Pixastic.prepareData(n),y=Pixastic.prepareData({canvas:t,options:n.options}),d=h.width*h.height,r=d*4,p=r+1,w=r+2,nt=r+3;d--;)(i[r-=4]+=u*y[r])>255&&(i[r]=255),(i[p-=4]+=u*y[p])>255&&(i[p]=255),(i[w-=4]+=u*y[w])>255&&(i[w]=255);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.histogram={process:function(n){var v=!!(n.options.average&&n.options.average!="false"),y=!!(n.options.paint&&n.options.paint!="false"),p=n.options.color||"rgba(255,255,255,0.5)",i=[],f,u,e,t;if(typeof n.options.returnValue!="object"&&(n.options.returnValue={values:[]}),f=n.options.returnValue,typeof f.values!="array"&&(f.values=[]),i=f.values,Pixastic.Client.hasCanvasImageData()){for(u=Pixastic.prepareData(n),n.useData=!1,t=0;t<256;t++)i[t]=0;var s=n.options.rect,o=s.width*s.height,r=o*4,w=r+1,b=r+2,k=r+3,h=Math.round;if(v)while(o--)i[h((u[r-=4]+u[r+1]+u[r+2])/3)]++;else while(o--)i[h(u[r-=4]*.3+u[r+1]*.59+u[r+2]*.11)]++;if(y){for(e=0,t=0;t<256;t++)i[t]>e&&(e=i[t]);var c=n.height/e,l=n.width/256,a=n.canvas.getContext("2d");for(a.fillStyle=p,t=0;t<256;t++)a.fillRect(t*l,n.height-c*i[t],l,i[t]*c)}return f.values=i,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.hsl={process:function(n){var b=parseInt(n.options.hue,10)||0,k=(parseInt(n.options.saturation,10)||0)/100,w=(parseInt(n.options.lightness,10)||0)/100,d,f,s,c,a,l,u,h,e,o;d=k<0?1+k:1+k*2;b=b%360/360;var y=b*6,g=w*255,nt=1+w,tt=1-w;if(Pixastic.Client.hasCanvasImageData()){for(var p=Pixastic.prepareData(n),it=n.options.rect,rt=it.width*it.height,v=rt*4,ut=v+1,ft=v+2,et=v+3;rt--;){var r=p[v-=4],t=p[ut=v+1],i=p[ft=v+2];(b!=0||k!=0)&&(f=r,t>f&&(f=t),i>f&&(f=i),s=r,t<s&&(s=t),i<s&&(s=i),c=f-s,a=(s+f)/510,a>0&&c>0&&(a<=.5?(l=c/(f+s)*d,l>1&&(l=1),u=a*(1+l)):(l=c/(510-f-s)*d,l>1&&(l=1),u=a+l-a*l),h=r==f?t==s?5+(f-i)/c+y:1-(f-t)/c+y:t==f?i==s?1+(f-r)/c+y:3-(f-i)/c+y:r==s?3+(f-t)/c+y:5-(f-r)/c+y,h<0&&(h+=6),h>=6&&(h-=6),e=a+a-u,o=h>>0,o==0?(r=u*255,t=(e+(u-e)*(h-o))*255,i=e*255):o==1?(r=(u-(u-e)*(h-o))*255,t=u*255,i=e*255):o==2?(r=e*255,t=u*255,i=(e+(u-e)*(h-o))*255):o==3?(r=e*255,t=(u-(u-e)*(h-o))*255,i=u*255):o==4?(r=(e+(u-e)*(h-o))*255,t=e*255,i=u*255):o==5&&(r=u*255,t=e*255,i=(u-(u-e)*(h-o))*255)));w<0?(r*=nt,t*=nt,i*=nt):w>0&&(r=r*tt+g,t=t*tt+g,i=i*tt+g);p[v]=r<0?0:r>255?255:r;p[ut]=t<0?0:t>255?255:t;p[ft]=i<0?0:i>255?255:i}return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.invert={process:function(n){if(Pixastic.Client.hasCanvasImageData()){for(var t=Pixastic.prepareData(n),s=!!n.options.invertAlpha,r=n.options.rect,u=r.width*r.height,i=u*4,f=i+1,e=i+2,o=i+3;u--;)t[i-=4]=255-t[i],t[f-=4]=255-t[f],t[e-=4]=255-t[e],s&&(t[o-=4]=255-t[o]);return!0}if(Pixastic.Client.isIE())return n.image.style.filter+=" invert",!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.laplace={process:function(n){var y=!!(n.options.invert&&n.options.invert!="false"),s=parseFloat(n.options.edgeStrength)||0,p=parseInt(n.options.greyLevel)||0;if(s=-s,Pixastic.Client.hasCanvasImageData()){var c=Pixastic.prepareData(n),t=Pixastic.prepareData(n,!0),l=1/8,a=n.options.rect,h=a.width,v=a.height,w=h*4,e=v;do{var b=(e-1)*w,k=e==v?e-1:e,d=e==1?0:e-2,g=d*h*4,nt=k*h*4,o=h;do{var r=b+(o*4-4),u=g+(o==1?0:o-2)*4,f=nt+(o==h?o-1:o)*4,tt=(-t[u-4]-t[u]-t[u+4]-t[r-4]-t[r+4]-t[f-4]-t[f]-t[f+4]+t[r]*8)*l,it=(-t[u-3]-t[u+1]-t[u+5]-t[r-3]-t[r+5]-t[f-3]-t[f+1]-t[f+5]+t[r+1]*8)*l,rt=(-t[u-2]-t[u+2]-t[u+6]-t[r-2]-t[r+6]-t[f-2]-t[f+2]-t[f+6]+t[r+2]*8)*l,i=(tt+it+rt)/3+p;s!=0&&(i>127?i+=(i+1-128)*s:i<127&&(i-=(i+1)*s));y&&(i=255-i);i<0&&(i=0);i>255&&(i=255);c[r]=c[r+1]=c[r+2]=i}while(--o)}while(--e);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.lighten={process:function(n){var r=parseFloat(n.options.amount)||0,i;if(r=Math.max(-1,Math.min(1,r)),Pixastic.Client.hasCanvasImageData()){for(var t=Pixastic.prepareData(n),s=n.options.rect,h=s.width*s.height,u=h*4,f=u+1,e=u+2,o=r+1;h--;)(t[u-=4]=t[u]*o)>255&&(t[u]=255),(t[f-=4]=t[f]*o)>255&&(t[f]=255),(t[e-=4]=t[e]*o)>255&&(t[e]=255);return!0}if(Pixastic.Client.isIE())return i=n.image,r<0?(i.style.filter+=" light()",i.filters[i.filters.length-1].addAmbient(255,255,255,100*-r)):r>0&&(i.style.filter+=" light()",i.filters[i.filters.length-1].addAmbient(255,255,255,100),i.filters[i.filters.length-1].addAmbient(255,255,255,100*r)),!0},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()||Pixastic.Client.isIE()}};Pixastic.Actions.mosaic={process:function(n){var f=Math.max(1,parseInt(n.options.blockSize,10)),a,o,y,r,u,s,h,c;if(Pixastic.Client.hasCanvasImageData()){var e=n.options.rect,t=e.width,i=e.height,p=t*4,r=i,v=n.canvas.getContext("2d"),l=document.createElement("canvas");for(l.width=l.height=1,a=l.getContext("2d"),o=document.createElement("canvas"),o.width=t,o.height=i,y=o.getContext("2d"),y.drawImage(n.canvas,e.left,e.top,t,i,0,0,t,i),r=0;r<i;r+=f)for(u=0;u<t;u+=f)s=f,h=f,s+u>t&&(s=t-u),h+r>i&&(h=i-r),a.drawImage(o,u,r,s,h,0,0,1,1),c=a.getImageData(0,0,1,1).data,v.fillStyle="rgb("+c[0]+","+c[1]+","+c[2]+")",v.fillRect(e.left+u,e.top+r,f,f);return n.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.noise={process:function(n){var h=0,c=0,v=!1,r,u,b,l,t;if(typeof n.options.amount!="undefined"&&(h=parseFloat(n.options.amount)||0),typeof n.options.strength!="undefined"&&(c=parseFloat(n.options.strength)||0),typeof n.options.mono!="undefined"&&(v=!!(n.options.mono&&n.options.mono!="false")),h=Math.max(0,Math.min(1,h)),c=Math.max(0,Math.min(1,c)),r=128*c,u=r/2,Pixastic.Client.hasCanvasImageData()){var i=Pixastic.prepareData(n),y=n.options.rect,p=y.width,k=y.height,d=p*4,w=k,f=Math.random;do{b=(w-1)*d;l=p;do if(t=b+(l-1)*4,f()<h){if(v)var a=-u+f()*r,e=i[t]+a,o=i[t+1]+a,s=i[t+2]+a;else var e=i[t]-u+f()*r,o=i[t+1]-u+f()*r,s=i[t+2]-u+f()*r;e<0&&(e=0);o<0&&(o=0);s<0&&(s=0);e>255&&(e=255);o>255&&(o=255);s>255&&(s=255);i[t]=e;i[t+1]=o;i[t+2]=s}while(--l)}while(--w);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.posterize={process:function(n){var r=256,t,v,e;if(typeof n.options.levels!="undefined"&&(r=parseInt(n.options.levels,10)||1),Pixastic.Client.hasCanvasImageData()){t=Pixastic.prepareData(n);r=Math.max(2,Math.min(256,r));var u=256/r,f=256/(r-1),c=n.options.rect,l=c.width,y=c.height,p=l*4,a=y;do{v=(a-1)*p;e=l;do{var i=v+(e-1)*4,o=f*(t[i]/u>>0),s=f*(t[i+1]/u>>0),h=f*(t[i+2]/u>>0);o>255&&(o=255);s>255&&(s=255);h>255&&(h=255);t[i]=o;t[i+1]=s;t[i+2]=h}while(--e)}while(--a);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.pointillize={process:function(n){var i=Math.max(1,parseInt(n.options.radius,10)),ut=Math.min(5,Math.max(0,parseFloat(n.options.density)||0)),b=Math.max(0,parseFloat(n.options.noise)||0),ft=!!(n.options.transparent&&n.options.transparent!="false"),d,v,rt,y,g,nt,a,p,e,o,s,h,c,l,w;if(Pixastic.Client.hasCanvasImageData()){var t=n.options.rect,r=t.width,u=t.height,et=r*4,a=u,f=n.canvas.getContext("2d"),tt=n.canvas.width,it=n.canvas.height,k=document.createElement("canvas");for(k.width=k.height=1,d=k.getContext("2d"),v=document.createElement("canvas"),v.width=r,v.height=u,rt=v.getContext("2d"),rt.drawImage(n.canvas,t.left,t.top,r,u,0,0,r,u),y=i*2,ft&&f.clearRect(t.left,t.top,t.width,t.height),g=i*b,nt=1/ut,a=0;a<u+i;a+=y*nt)for(p=0;p<r+i;p+=y*nt)rndX=b?p+(Math.random()*2-1)*g>>0:p,rndY=b?a+(Math.random()*2-1)*g>>0:a,e=rndX-i,o=rndY-i,e<0&&(e=0),o<0&&(o=0),s=rndX+t.left,h=rndY+t.top,s<0&&(s=0),s>tt&&(s=tt),h<0&&(h=0),h>it&&(h=it),c=y,l=y,c+e>r&&(c=r-e),l+o>u&&(l=u-o),c<1&&(c=1),l<1&&(l=1),d.drawImage(v,e,o,c,l,0,0,1,1),w=d.getImageData(0,0,1,1).data,f.fillStyle="rgb("+w[0]+","+w[1]+","+w[2]+")",f.beginPath(),f.arc(s,h,i,0,Math.PI*2,!0),f.closePath(),f.fill();return n.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.removenoise={process:function(n){if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(n),it=n.options.rect,l=it.width,rt=it.height,ut=l*4,h=rt;do{var ft=(h-1)*ut,et=h==rt?h-1:h,ot=h==1?0:h-2,st=ot*l*4,ht=et*l*4,c=l;do{var i=ft+(c*4-4),nt=st+(c==1?0:c-2)*4,tt=ht+(c==l?c-1:c)*4,r,u,f,e,o,s;r=u=t[nt];var a=t[i-4],v=t[i+4],y=t[tt];a<r&&(r=a);v<r&&(r=v);y<r&&(r=y);a>u&&(u=a);v>u&&(u=v);y>u&&(u=y);f=e=t[nt+1];var p=t[i-3],w=t[i+5],b=t[tt+1];p<f&&(f=p);w<f&&(f=w);b<f&&(f=b);p>e&&(e=p);w>e&&(e=w);b>e&&(e=b);o=s=t[nt+2];var k=t[i-2],d=t[i+6],g=t[tt+2];k<o&&(o=k);d<o&&(o=d);g<o&&(o=g);k>s&&(s=k);d>s&&(s=d);g>s&&(s=g);t[i]>u?t[i]=u:t[i]<r&&(t[i]=r);t[i+1]>e?t[i+1]=e:t[i+1]<f&&(t[i+1]=f);t[i+2]>s?t[i+2]=s:t[i+2]<o&&(t[i+2]=o)}while(--c)}while(--h);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.resize={process:function(n){var i;if(Pixastic.Client.hasCanvas()){var t=parseInt(n.options.width,10),u=parseInt(n.options.height,10),r=n.canvas;return t<1&&(t=1),t<2&&(t=2),i=document.createElement("canvas"),i.width=t,i.height=u,i.getContext("2d").drawImage(r,0,0,t,u),r.width=t,r.height=u,r.getContext("2d").drawImage(i,0,0),n.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.rotate={process:function(n){var o,t,e;if(Pixastic.Client.hasCanvas()){var u=n.canvas,i=n.width,r=n.height,f=document.createElement("canvas");f.width=i;f.height=r;f.getContext("2d").drawImage(u,0,0,i,r);o=-parseFloat(n.options.angle)*Math.PI/180;t=o;t>Math.PI*.5&&(t=Math.PI-t);t<-Math.PI*.5&&(t=-Math.PI-t);var s=Math.sqrt(i*i+r*r),l=Math.abs(t)-Math.abs(Math.atan2(r,i)),a=Math.abs(t)+Math.abs(Math.atan2(r,i)),h=Math.abs(Math.cos(l)*s),c=Math.abs(Math.sin(a)*s);return u.width=h,u.height=c,e=u.getContext("2d"),e.translate(h/2,c/2),e.rotate(o),e.drawImage(f,-i/2,-r/2),n.useData=!1,!0}},checkSupport:function(){return Pixastic.Client.hasCanvas()}};Pixastic.Actions.sepia={process:function(n){var r=parseInt(n.options.mode,10)||0,p,o,t;if(r<0&&(r=0),r>1&&(r=1),Pixastic.Client.hasCanvasImageData()){var i=Pixastic.prepareData(n),a=n.options.rect,v=a.width,w=a.height,b=v*4,y=w;do{p=(y-1)*b;o=v;do{if(t=p+(o-1)*4,r)var s=i[t]*.299+i[t+1]*.587+i[t+2]*.114,u=s+39,f=s+14,e=s-36;else var h=i[t],c=i[t+1],l=i[t+2],u=h*.393+c*.769+l*.189,f=h*.349+c*.686+l*.168,e=h*.272+c*.534+l*.131;u<0&&(u=0);u>255&&(u=255);f<0&&(f=0);f>255&&(f=255);e<0&&(e=0);e>255&&(e=255);i[t]=u;i[t+1]=f;i[t+2]=e}while(--o)}while(--y);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.sharpen={process:function(n){var e=0,a,v,y,u;if(typeof n.options.amount!="undefined"&&(e=parseFloat(n.options.amount)||0),e<0&&(e=0),e>1&&(e=1),Pixastic.Client.hasCanvasImageData()){var p=Pixastic.prepareData(n),t=Pixastic.prepareData(n,!0),o=15,r=1+3*e,nt=[[0,-r,0],[-r,o,-r],[0,-r,0]],s=0;for(a=0;a<3;a++)for(v=0;v<3;v++)s+=nt[a][v];s=1/s;var d=n.options.rect,w=d.width,g=d.height;o*=s;r*=s;y=w*4;u=g;do{var tt=(u-1)*y,it=u==g?u-1:u,rt=u==1?0:u-2,ut=rt*y,ft=it*y,f=w;do{var i=tt+(f*4-4),b=ut+(f==1?0:f-2)*4,k=ft+(f==w?f-1:f)*4,h=(-t[b]-t[i-4]-t[i+4]-t[k])*r+t[i]*o,c=(-t[b+1]-t[i-3]-t[i+5]-t[k+1])*r+t[i+1]*o,l=(-t[b+2]-t[i-2]-t[i+6]-t[k+2])*r+t[i+2]*o;h<0&&(h=0);c<0&&(c=0);l<0&&(l=0);h>255&&(h=255);c>255&&(c=255);l>255&&(l=255);p[i]=h;p[i+1]=c;p[i+2]=l}while(--f)}while(--u);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.solarize={process:function(n){var v=!!(n.options.average&&n.options.average!="false"),c,e;if(Pixastic.Client.hasCanvasImageData()){var t=Pixastic.prepareData(n),o=n.options.rect,s=o.width,l=o.height,a=s*4,h=l;do{c=(h-1)*a;e=s;do{var i=c+(e-1)*4,r=t[i],u=t[i+1],f=t[i+2];r>127&&(r=255-r);u>127&&(u=255-u);f>127&&(f=255-f);t[i]=r;t[i+1]=u;t[i+2]=f}while(--e)}while(--h);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};Pixastic.Actions.unsharpmask={process:function(n){var i=parseFloat(n.options.amount)||0,b=parseFloat(n.options.radius)||0,r=parseFloat(n.options.threshold)||0,l,k,u,a,ft,nt,c,tt,it,st,rt,t,y,o,p,s,w,h;if(i=Math.min(500,Math.max(0,i))/2,b=Math.min(5,Math.max(0,b))/10,r=Math.min(255,Math.max(0,r)),r--,l=-r,i*=.016,i++,Pixastic.Client.hasCanvasImageData()){k=n.options.rect;u=document.createElement("canvas");u.width=n.width;u.height=n.height;a=u.getContext("2d");a.drawImage(n.canvas,0,0);var ut=2,d=Math.round(n.width/ut),g=Math.round(n.height/ut),v=document.createElement("canvas");for(v.width=d,v.height=g,ft=Math.round(b*20),nt=v.getContext("2d"),c=0;c<ft;c++)tt=Math.max(1,Math.round(d-c)),it=Math.max(1,Math.round(g-c)),nt.clearRect(0,0,d,g),nt.drawImage(u,0,0,n.width,n.height,0,0,tt,it),a.clearRect(0,0,n.width,n.height),a.drawImage(v,0,0,tt,it,0,0,n.width,n.height);var f=Pixastic.prepareData(n),e=Pixastic.prepareData({canvas:u,options:n.options}),et=k.width,ht=k.height,ct=et*4,ot=ht;do{st=(ot-1)*ct;rt=et;do t=st+(rt*4-4),y=f[t]-e[t],(y>r||y<l)&&(o=e[t],o=i*y+o,f[t]=o>255?255:o<0?0:o),p=f[t+1]-e[t+1],(p>r||p<l)&&(s=e[t+1],s=i*p+s,f[t+1]=s>255?255:s<0?0:s),w=f[t+2]-e[t+2],(w>r||w<l)&&(h=e[t+2],h=i*w+h,f[t+2]=h>255?255:h<0?0:h);while(--rt)}while(--ot);return!0}},checkSupport:function(){return Pixastic.Client.hasCanvasImageData()}};
//# sourceMappingURL=pixastic.min.js.map
